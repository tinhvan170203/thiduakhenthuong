import{r as i,j as e,c as Q,e as V,d as D,Q as w,N as G}from"./index-371a4e8f.js";import{d as X}from"./Search-d057eaaa.js";import"./index.esm-a80e06b2.js";import{S as I}from"./react-select.esm-68469137.js";import{c as B}from"./canboApi-98c0e799.js";import{T as R,a as c,P as T,b as J,c as K,d as U,e as Z,f as ee,g as M,h as O,i as $,j as H}from"./LastPage-410e0def.js";import"./dayjs.min-9420a05b.js";import{P as ae,B as te,I as k}from"./MenuItem-0a823130.js";import{B as W}from"./Button-c29e04f7.js";import"./createSvgIcon-b5eb2c40.js";import"./ButtonBase-3ca56fd5.js";import"./memoize-one.esm-8b357e52.js";const le=({row:l,page:h,rowsPerPage:p,index:u,onHandleChangeItem:d,onHandleChangeText:x})=>{i.useState(null);const[r,m]=i.useState("null"),[f,b]=i.useState("");i.useEffect(()=>{l&&(m(l.thiduathang.result),b(l.thiduathang.ghichu))},[l]);const n=g=>{m(g.target.value),d(l,g.target.value)},j=g=>{b(g.target.value),x(l,g.target.value)};return e.jsxs(R,{children:[e.jsx(c,{className:"border-r border-slate-300",align:"center",style:{fontWeight:"bold",padding:"2px 2px"},children:h*p+u}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"},children:l.hoten}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{padding:"2px 2px"},children:l.bachamPopulate[0].bacham}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{padding:"2px 2px"},children:e.jsx("p",{className:"truncate",children:l.donviPopulate[0].tendoi})}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"},children:e.jsxs("select",{className:"outline-none px-2 w-full",onChange:g=>n(g),value:r,children:[e.jsx("option",{value:"null",children:"Chưa phân loại"}),e.jsx("option",{value:"red",children:"Cờ đỏ"}),e.jsx("option",{value:"blue",children:"Cờ xanh"}),e.jsx("option",{value:"yellow",children:"Cờ vàng"})]})}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{padding:"2px 2px"},children:e.jsx("input",{type:"text",className:`w-full outline-none border rounded-md px-2 py-[6px] border-neutral-300\r
                   focus:border-blue-500 focus:border-2`,value:f,onChange:g=>j(g)})})]},l._id)};function L(l){const h=Q(),{count:p,page:u,rowsPerPage:d,onPageChange:x}=l,r=n=>{x(n,0)},m=n=>{x(n,u-1)},f=n=>{x(n,u+1)},b=n=>{x(n,Math.max(0,Math.ceil(p/d)-1))};return e.jsxs(te,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(k,{onClick:r,disabled:u===0,"aria-label":"first page",children:h.direction==="rtl"?e.jsx(M,{}):e.jsx(O,{})}),e.jsx(k,{onClick:m,disabled:u===0,"aria-label":"previous page",children:h.direction==="rtl"?e.jsx($,{}):e.jsx(H,{})}),e.jsx(k,{onClick:f,disabled:u>=Math.ceil(p/d)-1,"aria-label":"next page",children:h.direction==="rtl"?e.jsx(H,{}):e.jsx($,{})}),e.jsx(k,{onClick:b,disabled:u>=Math.ceil(p/d)-1,"aria-label":"last page",children:h.direction==="rtl"?e.jsx(O,{}):e.jsx(M,{})})]})}L.propTypes={count:T.number.isRequired,onPageChange:T.func.isRequired,page:T.number.isRequired,rowsPerPage:T.number.isRequired};function ne({list:l,onHandleChangeAll:h,onHandleChangeItem:p,onHandleChangeText:u}){const[d,x]=i.useState(0),[r,m]=i.useState(10);d>0&&Math.max(0,(1+d)*r-l.length);const f=(n,j)=>{x(j)},b=n=>{m(parseInt(n.target.value,10)),x(0)};return e.jsxs(e.Fragment,{children:[e.jsx(J,{component:ae,style:{overflowX:"scroll"},children:e.jsxs(K,{"aria-label":"custom pagination table",children:[e.jsxs(U,{children:[e.jsxs(R,{children:[e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 2px",backgroundColor:"rgb(143 1 1)"},children:"#"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 2px",backgroundColor:"rgb(143 1 1)"},children:"Họ tên"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 2px",backgroundColor:"rgb(143 1 1)"},children:"Bậc hàm"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 2px",backgroundColor:"rgb(143 1 1)",minWidth:"300px"},children:"Đội, tổ công tác"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 2px",backgroundColor:"rgb(143 1 1)"},children:"Phân loại"}),e.jsx(c,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 2px",backgroundColor:"rgb(143 1 1)",minWidth:"300px"},children:"Ghi chú"})]}),e.jsxs(R,{children:[e.jsx(c,{colSpan:4,className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"}}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"},children:e.jsxs("select",{onChange:n=>h(n.target.value),className:"outline-none px-2 w-full",children:[e.jsx("option",{value:"null",children:"Chưa phân loại"}),e.jsx("option",{value:"red",children:"Cờ đỏ"}),e.jsx("option",{value:"blue",children:"Cờ xanh"}),e.jsx("option",{value:"yellow",children:"Cờ vàng"})]})}),e.jsx(c,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"}})]})]}),e.jsx(Z,{children:(r>0?l.slice(d*r,d*r+r):l).map((n,j)=>e.jsx(le,{row:n,page:d,rowsPerPage:r,index:j+1,onHandleChangeItem:p,onHandleChangeText:u},n._id))})]})}),e.jsx("div",{children:e.jsx(ee,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:l.length,rowsPerPage:r,page:d,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:f,onRowsPerPageChange:b,ActionsComponent:L,labelRowsPerPage:"Số cán bộ hiển thị trên mỗi trang",labelDisplayedRows:function({from:j,to:g,count:C}){return`hiển thị ${j} đến ${g} cán bộ trong tổng số ${C!==-1?C:`more than ${g}`} cán bộ`}})})]})}const be=()=>{const[l,h]=i.useState([]),[p,u]=i.useState(1),[d,x]=i.useState(1),[r,m]=i.useState(1),[f,b]=i.useState(2022),[n,j]=i.useState([]),[g,C]=V(),[N,P]=i.useState([]),[_,Y]=i.useState("");if(D(a=>a.authReducer.vaitro_theodoithidua)!=="Quản trị thông thường")return w.error("Tài khoản không có truy cập trang này",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!1,draggable:!1,progress:void 0,theme:"light"}),e.jsx(G,{to:"/login",replace:!0});i.useEffect(()=>{(async()=>{try{let t=await B.fetchYearMonth();m(t.data.month),u(t.data.month),b(t.data.year),x(t.data.year);let s=[];for(let o=t.data.year;o>=2020;o--)s.push({label:o,value:o});j(s)}catch(t){t.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(navigate("/login"),w.error(t.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(t.message)}})()},[]);const q=async()=>{try{C(!0);let a=await B.fetchThiduathang({month:r,year:f});P(a.data),h(a.data),u(r),x(f),C(!1)}catch(a){console.log(a.message)}};i.useEffect(()=>{const a=setTimeout(()=>{let s=[...l].filter(o=>o.hoten.toLowerCase().includes(_.toLowerCase()));P(s)},500);return()=>clearTimeout(a)},[_]);const z=a=>{let t=[...N];t=t.map(o=>({...o,thiduathang:{ghichu:o.thiduathang.ghichu,result:a}})),P(t);let s=[...l];for(let o of t){let v=s.findIndex(S=>S._id.toString()===o._id.toString());s[v].thiduathang.result=o.thiduathang.result}h(s)},A=(a,t)=>{let s=[...N],o=s.findIndex(y=>y._id.toString()===a._id.toString());s[o].thiduathang.result=t;let v=[...l],S=s.findIndex(y=>y._id.toString()===a._id.toString());v[S].thiduathang.result=t,h(v),P(s)},E=(a,t)=>{let s=[...N],o=s.findIndex(y=>y._id.toString()===a._id.toString());s[o].thiduathang.ghichu=t,P(s);let v=[...l],S=v.findIndex(y=>y._id.toString()===a._id.toString());v[S].thiduathang.ghichu=t,h(v)},F=async()=>{let a={doanviens:l,month:p,year:d};try{C(!0);let t=await B.updateThiduathang(a);w.success(t.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),C(!1)}catch(t){console.log(t.message)}};return D(a=>a.authReducer.roles_theodoithidua),e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"my-2",children:[e.jsx("h4",{className:"uppercase font-bold text-blue-800 text-sm md:text-[18px]",children:"Quản lý thi đua tháng của cán bộ, chiến sĩ"}),e.jsxs("p",{children:["Tháng ",p," Năm ",d]})]}),e.jsxs("div",{className:"flex space-x-2 md:flex-row justify-end items-center",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/6",children:[e.jsx("label",{className:"underline font-semibold",children:"Tháng:"}),e.jsx(I,{value:{label:r,value:r},required:!0,name:"thang",options:[{label:1,value:1},{label:2,value:2},{label:3,value:3},{label:4,value:4},{label:5,value:5},{label:6,value:6},{label:7,value:7},{label:8,value:8},{label:9,value:9},{label:10,value:10},{label:11,value:11},{label:12,value:12}],className:"basic-multi-select my-4",classNamePrefix:"select",onChange:a=>m(a.value)})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/6",children:[e.jsx("label",{className:"underline font-semibold",children:"Năm:"}),e.jsx(I,{value:{label:f,value:f},required:!0,name:"nam",options:n,className:"basic-multi-select my-4",classNamePrefix:"select",onChange:a=>b(a.value)})]}),e.jsx("div",{className:"flex-col flex md:basis-1/6",children:e.jsxs(W,{onClick:()=>q(),color:"primary",variant:"contained",children:[e.jsx(X,{})," Lấy dữ liệu thi đua"]})})]}),e.jsxs("div",{className:"mx-8 flex space-x-2 items-center",children:[e.jsx("input",{type:"text",defaultValue:_,onChange:a=>Y(a.target.value),placeholder:"Tìm kiếm họ tên",className:`outline-none my-4 border rounded-md px-2 py-[6px] border-neutral-300\r
                   focus:border-blue-500 focus:border-2`}),e.jsx(W,{onClick:()=>F(),color:"success",variant:"contained",children:" Lưu dữ liệu thi đua"})]}),e.jsx("div",{className:"mt-2 shadow-md shadow-gray-500 rounded-md",children:e.jsx(ne,{list:N,onHandleChangeItem:A,onHandleChangeAll:z,onHandleChangeText:E})})]})};export{be as default};
