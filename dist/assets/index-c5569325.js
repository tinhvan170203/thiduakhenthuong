import{r as b,j as e,s as J,d as K,c as U,h as X,e as Y,u as Z,Q as y}from"./index-469ebc4a.js";import{d as ee}from"./GridView-35e91095.js";import"./index.esm-a80e06b2.js";import{u as V,C}from"./index.esm-e24acc70.js";import{d as H}from"./Add-c692c54c.js";import{a as se,d as te}from"./AutoAwesomeMotion-01db5c5f.js";import{S as ae,D as le,a as re,d as ne,b as ie}from"./Cancel-be6c3443.js";import{S as M}from"./react-select.esm-ea0f231f.js";import{I as D,B as A,P as oe}from"./MenuItem-22e0308b.js";import{S as T}from"./Switch-a6bd2fbd.js";import{D as de}from"./DialogActions-425572d2.js";import{B as j}from"./Button-e3d685a6.js";import{D as ce}from"./DialogDelete-28d67f98.js";import{d as P}from"./donviApi-efae1bd9.js";import{T as _,a as i,P as S,b as ue,c as he,d as xe,e as me,f as fe,g as z,h as $,i as q,j as E}from"./LastPage-511a91a0.js";import{d as ge}from"./Edit-1cb268c9.js";import{k as pe}from"./khoiApi-b720f5dd.js";import"./createSvgIcon-e7baeffd.js";import"./ButtonBase-ea83d2d9.js";import"./memoize-one.esm-c82963f8.js";const be=b.forwardRef(function(t,o){return e.jsx(ae,{direction:"up",ref:o,...t})}),je=J(D)({position:"absolute",right:"16px",top:"4px"});function ve({open:l,item:t,onCloseDialogEdit:o,onSubmit:n,khois:m}){const{register:s,handleSubmit:h,control:d,resetField:v,watch:k,setValue:a,formState:{errors:u}}=V({defaultValues:{tendonvi:"",kyhieu:"",khoi:"",thutu:1,trangthai:!0,status:!0}});b.useEffect(()=>{t&&(a("tendonvi",t.tendonvi,{shouldValidate:!0}),a("kyhieu",t.kyhieu,{shouldValidate:!0}),a("thutu",t.thutu,{shouldValidate:!0}),a("status",t.status,{shouldValidate:!0}),a("trangthai",t.trangthai,{shouldValidate:!0}),a("khoi",{value:t.khoi._id,label:t.khoi.tenkhoi},{shouldValidate:!0}))},[t]);const g=async c=>{if(n){const p={...c,id_edit:t._id};await n(p),o()}};return e.jsx(e.Fragment,{children:e.jsxs(le,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(c,p)=>{p!=="backdropClick"&&o(c,p)},open:l,TransitionComponent:be,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(re,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"#03528f",margin:"0px"},children:[e.jsx(se,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa khối, hệ, lực lượng"}),e.jsx(je,{onClick:()=>o(),children:e.jsx(ne,{style:{color:"white"}})})]}),e.jsx(ie,{children:e.jsx(A,{children:e.jsxs("form",{className:"mt-2 mx-8",onSubmit:h(g),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên đơn vị: "]}),e.jsx("input",{...s("tendonvi",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Ký hiệu đơn vị: "]}),e.jsx("input",{...s("kyhieu",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...s("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/4",children:[e.jsx("label",{className:"underline font-semibold",children:"Đơn vị trực thuộc Công an tỉnh:"}),e.jsx(C,{name:"status",control:d,render:({field:{value:c,onChange:p}})=>e.jsx(T,{checked:c,onChange:p})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/4",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái:"}),e.jsx(C,{name:"trangthai",control:d,render:({field:{value:c,onChange:p}})=>e.jsx(T,{checked:c,onChange:p})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Khối, hệ, lực lượng: "]}),e.jsx(C,{control:d,name:"khoi",render:({field:c})=>e.jsx(M,{required:!0,name:"khoi",options:m,className:"basic-multi-select my-4",classNamePrefix:"select",...c})})]}),e.jsx(de,{children:e.jsxs(j,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(H,{}),e.jsx("span",{children:"Cập nhật"})]})})]})})})]})})}const ye=({row:l,page:t,rowsPerPage:o,index:n,onClickOpenDialogEdit:m,onClickOpenDialogDelete:s})=>{b.useState(null);const h=K(d=>d.authReducer.roles_quanlydoanvien);return e.jsxs(_,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(i,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:t*o+n}),e.jsx(i,{className:"border-r border-slate-300",align:"left",children:l.tendonvi}),e.jsx(i,{className:"border-r border-slate-300",align:"left",children:l.kyhieu}),e.jsx(i,{className:"border-r border-slate-300",align:"left",children:l.khoi.tenkhoi}),e.jsx(i,{className:"border-r border-slate-300",align:"left",children:l.thutu}),e.jsx(i,{className:"border-r border-slate-300",align:"left",children:l.status===!0?e.jsx(j,{color:"success",children:"Có"}):e.jsx(j,{color:"warning",children:"Không"})}),e.jsx(i,{className:"border-r border-slate-300",align:"left",children:l.trangthai===!0?e.jsx(j,{color:"success",children:"Active"}):e.jsx(j,{color:"warning",children:"None Active"})}),e.jsxs(i,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[h&&h.includes("sửa mô hình tổ chức")&&e.jsx(j,{variant:"contained",color:"info",size:"small",onClick:()=>m(l),children:e.jsx(ge,{style:{fontSize:"20px"}})}),h&&h.includes("xóa mô hình tổ chức")&&e.jsx(j,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>s(l._id),children:e.jsx(te,{style:{fontSize:"20px"}})})]})]},l._id)};function F(l){const t=U(),{count:o,page:n,rowsPerPage:m,onPageChange:s}=l,h=a=>{s(a,0)},d=a=>{s(a,n-1)},v=a=>{s(a,n+1)},k=a=>{s(a,Math.max(0,Math.ceil(o/m)-1))};return e.jsxs(A,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(D,{onClick:h,disabled:n===0,"aria-label":"first page",children:t.direction==="rtl"?e.jsx(z,{}):e.jsx($,{})}),e.jsx(D,{onClick:d,disabled:n===0,"aria-label":"previous page",children:t.direction==="rtl"?e.jsx(q,{}):e.jsx(E,{})}),e.jsx(D,{onClick:v,disabled:n>=Math.ceil(o/m)-1,"aria-label":"next page",children:t.direction==="rtl"?e.jsx(E,{}):e.jsx(q,{})}),e.jsx(D,{onClick:k,disabled:n>=Math.ceil(o/m)-1,"aria-label":"last page",children:t.direction==="rtl"?e.jsx($,{}):e.jsx(z,{})})]})}F.propTypes={count:S.number.isRequired,onPageChange:S.func.isRequired,page:S.number.isRequired,rowsPerPage:S.number.isRequired};function ke({list:l,onClickOpenDialogEdit:t,onClickOpenDialogDelete:o}){const[n,m]=b.useState(0),[s,h]=b.useState(10),d=n>0?Math.max(0,(1+n)*s-l.length):0,v=(a,u)=>{m(u)},k=a=>{h(parseInt(a.target.value,10)),m(0)};return e.jsxs(e.Fragment,{children:[e.jsx(ue,{component:oe,children:e.jsxs(he,{"aria-label":"custom pagination table",children:[e.jsx(xe,{children:e.jsxs(_,{children:[e.jsx(i,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"#"}),e.jsx(i,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"Tên đơn vị"}),e.jsx(i,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"Ký hiệu"}),e.jsx(i,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"Khối"}),e.jsx(i,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(143 1 1)"},children:"Thứ tự"}),e.jsx(i,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"200px",backgroundColor:"rgb(143 1 1)"},children:"Trực thuộc Công an tỉnh"}),e.jsx(i,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"200px",backgroundColor:"rgb(143 1 1)"},children:"Trạng thái"}),e.jsx(i,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(me,{children:[(s>0?l.slice(n*s,n*s+s):l).map((a,u)=>e.jsx(ye,{row:a,page:n,rowsPerPage:s,index:u+1,onClickOpenDialogEdit:t,onClickOpenDialogDelete:o},a._id)),d>0&&e.jsx(_,{style:{height:53*d},children:e.jsx(i,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(fe,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:l.length,rowsPerPage:s,page:n,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:v,onRowsPerPageChange:k,ActionsComponent:F,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:u,to:g,count:c}){return`hiển thị ${u} đến ${g} bản ghi trong tổng số ${c!==-1?c:`more than ${g}`} bản ghi`}})})]})}const Le=()=>{X();const[l,t]=b.useState([]),[o,n]=b.useState([]),[m,s]=Y(),h=Z(),[d,v]=b.useState({status:!1,item:null}),k=()=>{v({...d,status:!1})},a=r=>{v({item:r,status:!0})},[u,g]=b.useState({status:!1,id_Delete:null}),c=r=>{g({status:!0,id_Delete:r})},p=()=>{g({...u,status:!1})},W=()=>{g({...u,status:!1})},{register:w,handleSubmit:L,control:O,resetField:N,watch:Ce,formState:{errors:Ne}}=V({defaultValues:{tendonvi:"",kyhieu:"",khoi:"",trangthai:!0,thutu:1,status:!0}});b.useEffect(()=>{(async()=>{try{s(!0);let x=await P.getDonvis(),f=await pe.getKhois();t(x.data),n(f.data.map(R=>({value:R._id,label:R.tenkhoi}))),setTimeout(()=>{s(!1)},400)}catch(x){x.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(h("/login"),s(!1),y.error(x.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}))}})()},[]);const I=async r=>{let x={...r};s(!0);try{let f=await P.addDonvi(x);t(f.data.donvis),setTimeout(()=>{s(!1)},400),N("tendonvi"),N("kyhieu"),N("thutu"),N("khoi"),N("status"),y.success(f.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(f){y.error(f.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},Q=async r=>{let x={...r};s(!0);try{let f=await P.editDonvi(x);t(f.data.donvis),setTimeout(()=>{s(!1)},400),y.success(f.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(f){y.error(f.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},G=async()=>{s(!0);try{let r=await P.deleteDonvi(u.id_Delete);t(r.data.donvis),setTimeout(()=>{s(!1)},400),g({...u,status:!1}),y.success(r.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(r){g({...u,status:!1}),y.error(r.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},B=K(r=>r.authReducer.roles_theodoithidua);return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{color:"primary",fontSize:"large"}),e.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:"Quản lý đơn vị cấp phòng, huyện, thị xã, thành phố"})]}),B&&B.includes("thêm mô hình tổ chức")&&e.jsxs("form",{className:"mt-2 mx-8",onSubmit:L(I),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên đơn vị: "]}),e.jsx("input",{...w("tendonvi",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Ký hiệu đơn vị: "]}),e.jsx("input",{...w("kyhieu",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/3",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...w("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/3",children:[e.jsx("label",{className:"underline font-semibold",children:"Đơn vị trực thuộc Công an tỉnh:"}),e.jsx(C,{name:"status",control:O,render:({field:{value:r,onChange:x}})=>e.jsx(T,{checked:r,onChange:x})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái hoạt động:"}),e.jsx(C,{name:"trangthai",control:O,render:({field:{value:r,onChange:x}})=>e.jsx(T,{checked:r,onChange:x})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Khối, hệ, lực lượng: "]}),e.jsx(C,{control:O,name:"khoi",render:({field:r})=>e.jsx(M,{required:!0,name:"khoi",options:o,className:"basic-multi-select my-4",classNamePrefix:"select",...r})})]}),e.jsx("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:e.jsxs(j,{type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(H,{})," Thêm mới"]})})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx(ke,{list:l,onClickOpenDialogDelete:c,onClickOpenDialogEdit:a})}),e.jsx(ve,{open:d.status,item:d.item,onCloseDialogEdit:k,onSubmit:Q,khois:o}),e.jsx(ce,{open:u.status,onCloseDialogDelete:W,onConfirmDelete:G,onCancelDelete:p})]})};export{Le as default};
