import{r as x,j as e,c as M,e as Y,d as _,Q as k}from"./index-371a4e8f.js";import{d as z}from"./Search-d057eaaa.js";import"./index.esm-a80e06b2.js";import{S as A}from"./react-select.esm-68469137.js";import{c as T}from"./canboApi-98c0e799.js";import{T as H,a as d,P as S,b as K,c as E,d as V,e as F,f as Q,g as B,h as R,i as w,j as W}from"./LastPage-410e0def.js";import"./dayjs.min-9420a05b.js";import{P as G,B as J,I as N}from"./MenuItem-0a823130.js";import{B as I}from"./Button-c29e04f7.js";import"./createSvgIcon-b5eb2c40.js";import"./ButtonBase-3ca56fd5.js";import"./memoize-one.esm-8b357e52.js";const U=({row:a,page:c,rowsPerPage:f,index:h,onHandleChangeItem:s,onHandleChangeText:u})=>{const[g,v]=x.useState("null"),[y,m]=x.useState("");x.useEffect(()=>{a&&(v(a.xeploaidangvien.result),m(a.xeploaidangvien.ghichu))},[a]);const t=o=>{v(o.target.value),s(a,o.target.value)},p=o=>{m(o.target.value),u(a,o.target.value)};return e.jsxs(H,{children:[e.jsx(d,{className:"border-r border-slate-300",align:"center",style:{fontWeight:"bold",padding:"2px 2px"},children:c*f+h}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"},children:a.hoten}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{padding:"2px 2px"},children:a.bachamPopulate[0].bacham}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{padding:"2px 2px"},children:e.jsx("p",{className:"truncate",children:a.donviPopulate[0].tendoi})}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"},children:e.jsxs("select",{className:"outline-none p-2 w-full",onChange:o=>t(o),value:g,children:[e.jsx("option",{value:"null",children:"Chưa phân loại"}),e.jsx("option",{value:"Không hoàn thành nhiệm vụ",children:"Không hoàn thành nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành nhiệm vụ",children:"Hoàn thành nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành tốt nhiệm vụ",children:"Hoàn thành tốt nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành xuất sắc nhiệm vụ",children:"Hoàn thành xuất sắc nhiệm vụ"})]})}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{padding:"2px 2px"},children:e.jsx("input",{type:"text",className:`w-full outline-none border rounded-md px-2 py-[6px] border-neutral-300\r
                   focus:border-blue-500 focus:border-2`,value:y,onChange:o=>p(o)})})]},a._id)};function O(a){const c=M(),{count:f,page:h,rowsPerPage:s,onPageChange:u}=a,g=t=>{u(t,0)},v=t=>{u(t,h-1)},y=t=>{u(t,h+1)},m=t=>{u(t,Math.max(0,Math.ceil(f/s)-1))};return e.jsxs(J,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(N,{onClick:g,disabled:h===0,"aria-label":"first page",children:c.direction==="rtl"?e.jsx(B,{}):e.jsx(R,{})}),e.jsx(N,{onClick:v,disabled:h===0,"aria-label":"previous page",children:c.direction==="rtl"?e.jsx(w,{}):e.jsx(W,{})}),e.jsx(N,{onClick:y,disabled:h>=Math.ceil(f/s)-1,"aria-label":"next page",children:c.direction==="rtl"?e.jsx(W,{}):e.jsx(w,{})}),e.jsx(N,{onClick:m,disabled:h>=Math.ceil(f/s)-1,"aria-label":"last page",children:c.direction==="rtl"?e.jsx(R,{}):e.jsx(B,{})})]})}O.propTypes={count:S.number.isRequired,onPageChange:S.func.isRequired,page:S.number.isRequired,rowsPerPage:S.number.isRequired};function Z({list:a,onHandleChangeAll:c,onHandleChangeItem:f,onHandleChangeText:h}){const[s,u]=x.useState(0),[g,v]=x.useState(10);s>0&&Math.max(0,(1+s)*g-a.length);const y=(t,p)=>{u(p)},m=t=>{v(parseInt(t.target.value,10)),u(0)};return e.jsxs(e.Fragment,{children:[e.jsx(K,{component:G,style:{overflowX:"scroll"},children:e.jsxs(E,{"aria-label":"custom pagination table",children:[e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"#"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"250px"},children:"Họ tên"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"120px"},children:"Bậc hàm"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"300px"},children:"Đội, tổ công tác"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"120px"},children:"Kết quả xếp loại đảng viên"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"300px"},children:"Ghi chú"})]}),e.jsxs(H,{children:[e.jsx(d,{colSpan:4,className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"}}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"},children:e.jsxs("select",{onChange:t=>c(t.target.value),className:"outline-none px-2 w-full",defaultValue:"null",children:[e.jsx("option",{value:"null",children:"Chưa phân loại"}),e.jsx("option",{value:"Không hoàn thành nhiệm vụ",children:"Không hoàn thành nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành nhiệm vụ",children:"Hoàn thành nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành tốt nhiệm vụ",children:"Hoàn thành tốt nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành xuất sắc nhiệm vụ",children:"Hoàn thành xuất sắc nhiệm vụ"})]})}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"}})]})]}),e.jsx(F,{children:(g>0?a.slice(s*g,s*g+g):a).map((t,p)=>e.jsx(U,{row:t,page:s,rowsPerPage:g,index:p+1,onHandleChangeItem:f,onHandleChangeText:h},t._id))})]})}),e.jsx("div",{children:e.jsx(Q,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:a.length,rowsPerPage:g,page:s,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:y,onRowsPerPageChange:m,ActionsComponent:O,labelRowsPerPage:"Số cán bộ hiển thị trên mỗi trang",labelDisplayedRows:function({from:p,to:o,count:P}){return`hiển thị ${p} đến ${o} cán bộ trong tổng số ${P!==-1?P:`more than ${o}`} cán bộ`}})})]})}const pe=()=>{const[a,c]=x.useState([]),[f,h]=x.useState(1),[s,u]=x.useState(2022),[g,v]=x.useState([]),[y,m]=Y(),[t,p]=x.useState([]),[o,P]=x.useState("");if(_(n=>n.authReducer.vaitro_theodoithidua)!=="Quản trị thông thường")return k.error("Tài khoản không có truy cập trang này",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!1,draggable:!1,progress:void 0,theme:"light"}),e.jsx(Navigate,{to:"/login",replace:!0});x.useEffect(()=>{(async()=>{try{let l=await T.fetchYearMonth();u(l.data.year),h(l.data.year);let i=[];for(let r=l.data.year;r>=2020;r--)i.push({label:r,value:r});v(i)}catch(l){l.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(navigate("/login"),k.error(l.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(l.message)}})()},[]);const $=async()=>{try{m(!0);let n=await T.fetchXeploaidangvien({year:s});p(n.data),c(n.data),h(s),m(!1)}catch(n){console.log(n.message)}};x.useEffect(()=>{const n=setTimeout(()=>{let i=[...a].filter(r=>r.hoten.toLowerCase().includes(o.toLowerCase()));p(i)},500);return()=>clearTimeout(n)},[o]);const D=n=>{let l=[...t];l=l.map(r=>({...r,xeploaidangvien:{ghichu:r.xeploaidangvien.ghichu,result:n}})),p(l);let i=[...a];for(let r of l){let b=i.findIndex(C=>C._id.toString()===r._id.toString());i[b].xeploaidangvien.result=r.xeploaidangvien.result}c(i)},X=(n,l)=>{let i=[...t],r=i.findIndex(j=>j._id.toString()===n._id.toString());i[r].xeploaidangvien.result=l;let b=[...a],C=i.findIndex(j=>j._id.toString()===n._id.toString());b[C].xeploaidangvien.result=l,c(b),p(i)},q=(n,l)=>{let i=[...t],r=i.findIndex(j=>j._id.toString()===n._id.toString());i[r].xeploaidangvien.ghichu=l,p(i);let b=[...a],C=b.findIndex(j=>j._id.toString()===n._id.toString());b[C].xeploaidangvien.ghichu=l,c(b)},L=async()=>{let n={doanviens:a,year:f};try{m(!0);let l=await T.updateXeploaidangvien(n);k.success(l.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),m(!1)}catch(l){console.log(l.message)}};return _(n=>n.authReducer.roles_theodoithidua),e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsx("div",{className:"my-2",children:e.jsx("h4",{className:"uppercase font-bold text-blue-800 text-sm md:text-[18px]",children:"Quản lý xếp loại đảng viên thuộc đơn vị"})}),e.jsxs("div",{className:"flex space-x-2 md:flex-row justify-end items-center",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/6",children:[e.jsx("label",{className:"underline font-semibold",children:"Năm:"}),e.jsx(A,{value:{label:s,value:s},required:!0,name:"nam",options:g,className:"basic-multi-select my-4",classNamePrefix:"select",onChange:n=>u(n.value)})]}),e.jsx("div",{className:"flex-col flex md:basis-1/6",children:e.jsxs(I,{onClick:()=>$(),color:"primary",variant:"contained",children:[e.jsx(z,{})," Lấy dữ liệu đảng viên"]})})]}),e.jsxs("div",{className:"mx-8 flex space-x-2 items-center",children:[e.jsx("input",{type:"text",defaultValue:o,onChange:n=>P(n.target.value),placeholder:"Tìm kiếm họ tên",className:`outline-none my-4 border rounded-md px-2 py-[6px] border-neutral-300\r
                   focus:border-blue-500 focus:border-2`}),e.jsx(I,{onClick:()=>L(),color:"success",variant:"contained",children:" Lưu dữ liệu xếp loại đảng viên"})]}),e.jsxs("div",{className:"mt-2 shadow-md shadow-gray-500 rounded-md",children:[e.jsxs("p",{className:"text-center text-lg my-8 font-semibold",children:["Kết quả xếp loại đảng viên năm ",f," của đơn vị"]}),e.jsx(Z,{list:t,onHandleChangeItem:X,onHandleChangeAll:D,onHandleChangeText:q})]})]})};export{pe as default};
