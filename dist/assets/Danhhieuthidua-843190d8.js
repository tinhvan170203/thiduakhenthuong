import{r as o,j as e,s as G,d as $,c as be,u as je,Q as b,e as ye,h as Ce}from"./index-371a4e8f.js";import{d as L}from"./Search-d057eaaa.js";import"./index.esm-a80e06b2.js";import{u as V,C as z}from"./index.esm-dbde89ce.js";import{d as A}from"./Add-b80d7046.js";import{q as ke}from"./base-e8aaf39e.js";import{a as J,d as ve}from"./AutoAwesomeMotion-e68ec9ef.js";import{S as U,D as X,a as Y,d as Z,b as ee}from"./Cancel-e1a5b8c1.js";import{S as F}from"./react-select.esm-68469137.js";import{I as S,B as H,P as Ne}from"./MenuItem-0a823130.js";import{D as te}from"./DialogActions-8285de49.js";import{B as v}from"./Button-c29e04f7.js";import{k as D}from"./khenthuongApi-fb0698d8.js";import{T as E,a as x,P as R,b as De,c as Se,d as Pe,e as we,f as Te,g as W,h as K,i as I,j as Q}from"./LastPage-410e0def.js";import{d as Be}from"./Edit-3f190fda.js";import"./dayjs.min-9420a05b.js";import{D as Oe}from"./DialogDelete-f47675d7.js";import"./Link-24b18a5a.js";import{d as _e}from"./doiApi-e594bd3e.js";import"./createSvgIcon-b5eb2c40.js";import"./ButtonBase-3ca56fd5.js";import"./memoize-one.esm-8b357e52.js";const Re=o.forwardRef(function(i,s){return e.jsx(U,{direction:"up",ref:s,...i})}),$e=G(S)({position:"absolute",right:"16px",top:"4px"});function qe({open:r,onCloseDialogAdd:i,onSubmit:s,chidoans:a}){const{register:h,handleSubmit:d,control:p,resetField:u,setValue:j,watch:y,formState:{errors:c}}=V({defaultValues:{}});o.useState([]);const l=async g=>{if(s){const f={...g};await s(f),u("nam"),u("noidung")}};return e.jsx(e.Fragment,{children:e.jsxs(X,{maxWidth:"xl",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(g,f)=>{f!=="backdropClick"&&i(g,f)},open:r,TransitionComponent:Re,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(Y,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"#03528f",margin:"0px"},children:[e.jsx(J,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Thêm mới danh hiệu thi đua cho tập thể"}),e.jsx($e,{onClick:()=>i(),children:e.jsx(Z,{style:{color:"white"}})})]}),e.jsx(ee,{children:e.jsx(H,{children:e.jsx("form",{className:"mt-2 mx-8",onSubmit:d(l),children:e.jsxs("div",{className:"flex flex-wrap xl:flex-row flex-col flex-1 p-2",children:[e.jsxs("div",{className:"flex-col md:basis-1/3 flex flex-1 px-1",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Năm đạt danh hiệu thi đua: "]}),e.jsx("input",{...h("nam",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col md:basis-full flex flex-1 px-1",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nội dung và ghi chú: "]}),e.jsx("input",{...h("noidung",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col md:basis-full flex flex-1 px-1",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"}),"Tập thể đạt danh hiệu thi đua: "]}),e.jsx(z,{control:p,name:"taptheduockhenthuong",render:({field:g})=>e.jsx(F,{options:a,className:"basic-multi-select my-4 p-1",classNamePrefix:"select",placeholder:"Vui lòng chọn tập thể được khen thưởng",required:!0,...g})})]}),e.jsx(te,{children:e.jsxs(v,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(A,{}),e.jsx("span",{children:"Thêm mới"})]})})]})})})})]})})}const Ee=({row:r,page:i,rowsPerPage:s,index:a,onClickOpenDialogEdit:h,onClickOpenDialogDelete:d})=>(o.useState(null),$(p=>p.authReducer.roles_quanlydoanvien),e.jsxs(E,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(x,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:i*s+a}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:e.jsx("span",{className:"font-bold",children:r.nam})}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:r.noidung}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:r.tapthe}),e.jsxs(x,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[e.jsx(v,{variant:"contained",color:"info",size:"small",onClick:()=>h(r),children:e.jsx(Be,{style:{fontSize:"20px"}})}),e.jsx(v,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>d(r._id,r.cap),children:e.jsx(ve,{style:{fontSize:"20px"}})})]})]},r._id));function se(r){const i=be(),{count:s,page:a,rowsPerPage:h,onPageChange:d}=r,p=c=>{d(c,0)},u=c=>{d(c,a-1)},j=c=>{d(c,a+1)},y=c=>{d(c,Math.max(0,Math.ceil(s/h)-1))};return e.jsxs(H,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(S,{onClick:p,disabled:a===0,"aria-label":"first page",children:i.direction==="rtl"?e.jsx(W,{}):e.jsx(K,{})}),e.jsx(S,{onClick:u,disabled:a===0,"aria-label":"previous page",children:i.direction==="rtl"?e.jsx(I,{}):e.jsx(Q,{})}),e.jsx(S,{onClick:j,disabled:a>=Math.ceil(s/h)-1,"aria-label":"next page",children:i.direction==="rtl"?e.jsx(Q,{}):e.jsx(I,{})}),e.jsx(S,{onClick:y,disabled:a>=Math.ceil(s/h)-1,"aria-label":"last page",children:i.direction==="rtl"?e.jsx(K,{}):e.jsx(W,{})})]})}se.propTypes={count:R.number.isRequired,onPageChange:R.func.isRequired,page:R.number.isRequired,rowsPerPage:R.number.isRequired};function Ve({list:r,onClickOpenDialogEdit:i,onClickOpenDialogDelete:s}){const[a,h]=o.useState(0),[d,p]=o.useState(10),u=a>0?Math.max(0,(1+a)*d-r.length):0,j=(c,l)=>{h(l)},y=c=>{p(parseInt(c.target.value,10)),h(0)};return e.jsxs(e.Fragment,{children:[e.jsx(De,{component:Ne,children:e.jsxs(Se,{"aria-label":"custom pagination table",children:[e.jsx(Pe,{children:e.jsxs(E,{children:[e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"#"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"Năm"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(143 1 1)"},children:"Danh hiệu thi đua"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(143 1 1)"},children:"Tập thể đạt danh hiệu"}),e.jsx(x,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(we,{children:[(d>0?r.slice(a*d,a*d+d):r).map((c,l)=>e.jsx(Ee,{row:c,page:a,rowsPerPage:d,index:l+1,onClickOpenDialogEdit:i,onClickOpenDialogDelete:s},c._id)),u>0&&e.jsx(E,{style:{height:53*u},children:e.jsx(x,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(Te,{rowsPerPageOptions:[1,10,25,50,100],count:r.length,rowsPerPage:d,page:a,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:j,onRowsPerPageChange:y,ActionsComponent:se,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:l,to:g,count:f}){return`hiển thị ${l} đến ${g} bản ghi trong tổng số ${f!==-1?f:`more than ${g}`} bản ghi`}})})]})}const ze=o.forwardRef(function(i,s){return e.jsx(U,{direction:"up",ref:s,...i})}),Ae=G(S)({position:"absolute",right:"16px",top:"4px"});function Fe({open:r,onCloseDialogEdit:i,item:s,onSubmit:a,capkhen:h,hinhthuc:d,chidoans:p}){const{register:u,handleSubmit:j,control:y,resetField:c,setValue:l,watch:g,formState:{errors:f}}=V({defaultValues:{}}),[T,B]=o.useState("");o.useEffect(()=>{s&&(B(s.cap),l("nam",s.nam,{shouldValidate:!0}),l("noidung",s.noidung,{shouldValidate:!0}),l("taptheduockhenthuong",{value:s.tapthe_id,label:s.tapthe},{shouldValidate:!0}))},[s]);const O=async N=>{if(a){const k={...N,id_edit:s._id,capkhenBefore:T};await a(k),i()}};return e.jsx(e.Fragment,{children:e.jsxs(X,{maxWidth:"xl",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(N,k)=>{k!=="backdropClick"&&i(N,k)},open:r,TransitionComponent:ze,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(Y,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"#03528f",margin:"0px"},children:[e.jsx(J,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa danh hiệu thi đua tập thể"}),e.jsx(Ae,{onClick:()=>i(),children:e.jsx(Z,{style:{color:"white"}})})]}),e.jsx(ee,{children:e.jsx(H,{children:e.jsx("form",{className:"mt-2 mx-8",onSubmit:j(O),children:e.jsxs("div",{className:"flex flex-wrap xl:flex-row flex-col flex-1 p-2",children:[e.jsxs("div",{className:"flex-col md:basis-1/3 flex flex-1 px-1",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Năm đạt danh hiệu: "]}),e.jsx("input",{...u("nam",{required:!0}),disabled:!0,type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col md:basis-full flex flex-1 px-1",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nội dung và ghi chú: "]}),e.jsx("input",{...u("noidung",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col md:basis-full flex flex-1 px-1",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"}),"Tập thể đạt danh hiệu: "]}),e.jsx(z,{control:y,name:"taptheduockhenthuong",render:({field:N})=>e.jsx(F,{isDisabled:!0,options:p,className:"basic-multi-select my-4 p-1",classNamePrefix:"select",placeholder:"Vui lòng chọn tập thể được khen thưởng",required:!0,...N})})]}),e.jsx(te,{children:e.jsxs(v,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(A,{}),e.jsx("span",{children:"Cập nhật dữ liệu"})]})})]})})})})]})})}const mt=()=>{let r=$(t=>t.authReducer.vaitro_theodoithidua);const i=je();if(r!=="Quản trị thông thường")return b.error("Tài khoản không có truy cập trang này",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!1,draggable:!1,progress:void 0,theme:"light"}),e.jsx(Navigate,{to:"/login",replace:!0});const[s,a]=o.useState([]),[h,d]=o.useState([]),[p,u]=o.useState(!1),[j,y]=o.useState([]),[c,l]=ye();let[g,f]=Ce();const[T,B]=o.useState({status:!1}),[O,N]=o.useState([]);o.useState([]);const[k,He]=o.useState([]);o.useState([]);const ae=t=>{B({status:!0})},le=()=>{B({...T,status:!1})},[q,M]=o.useState({status:!1,item:null}),[C,P]=o.useState({status:!1,id_Delete:null,capkhenBefore:null}),ne=t=>{M({item:t,status:!0})},re=()=>{M({...q,status:!1})},ie=()=>{P({...C,status:!1})},oe=()=>{P({...C,status:!1})},de=(t,n)=>{P({status:!0,id_Delete:t,capkhenBefore:n})};let _=$(t=>t.authReducer);o.useEffect(()=>{(async()=>{try{let n=await _e.getDois({tendoi:"",donvi:""});d([{label:_.user,value:_.id_user}].concat(n.data.map(m=>({label:m.tendoi,value:m._id})))),y([{label:"Tất cả",value:""}].concat([{label:_.user,value:_.id_user}].concat(n.data.map(m=>({label:m.tendoi,value:m._id})))))}catch(n){n.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),b.error(n.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(n.message)}})()},[]);const{register:ce,handleSubmit:he,control:ue,resetField:Me,setValue:Le,watch:We,formState:{errors:Ke}}=V({defaultValues:{taptheduockhenthuong:{label:"Tất cả",value:""}}}),pe=t=>{f({...w,...t,taptheduockhenthuong:t.taptheduockhenthuong.value})},w=o.useMemo(()=>{const t=ke.parse(location.search);return{...t,nam:t.nam||"",noidung:t.noidung||"",taptheduockhenthuong:t.taptheduockhenthuong||""}},[location.search]);o.useEffect(()=>{(async()=>{try{l(!0);let n=await D.getDanhhieuthiduas(w);a(n.data),l(!1)}catch(n){n.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(i("/login"),l(!1),b.error(n.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(n.message)}})()},[w]);const me=async t=>{try{l(!0);let n=await D.addDanhhieuthidua(t),m=await D.getDanhhieuthiduas(w);a(m.data),l(!1),b.success(n.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(n){b.error(n.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),l(!1)}},xe=async()=>{l(!0);try{let t=await D.deleteDanhhieuthidua(C.id_Delete,{capkhenBefore:C.capkhenBefore}),m=[...s].filter(fe=>fe._id.toString()!==C.id_Delete);a(m),l(!1),P({...C,status:!1}),b.success(t.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(t){P({...C,status:!1}),b.error(t.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),l(!1)}},ge=async t=>{try{l(!0);let n=await D.editDanhhieuthidua(t),m=await D.getDanhhieuthiduas(w);a(m.data),l(!1),b.success(n.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(n){b.error(n.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),l(!1)}};return $(t=>t.authReducer.roles_theodoithidua),e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsx("div",{className:"my-2",children:e.jsx("h4",{className:"uppercase font-bold text-blue-800 text-sm md:text-[18px]",children:"Quản lý danh hiệu thi đua đối với tập thể đơn vị"})}),e.jsxs("div",{className:"mt-4 text-end md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:[e.jsxs(v,{type:"submit",onClick:()=>ae(),color:"primary",variant:"contained",children:[e.jsx(A,{})," Thêm mới danh hiệu thi đua"]}),e.jsxs(v,{onClick:()=>u(!0),color:"info",variant:"contained",children:[e.jsx(L,{})," Chức năng tìm kiếm "]})]}),p&&e.jsxs("form",{onSubmit:he(pe),className:"my-2 mt-4 shadow-gray-400 shadow-md p-4 rounded-lg","data-aos":"zoom-in-down","data-aos-once":"true",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx("h5",{className:"text-[18px] font-semibold",children:"Tìm kiếm danh hiệu thi đua"})}),e.jsxs("div",{className:"flex flex-wrap xl:flex-row flex-col flex-1 p-2",children:[e.jsxs("div",{className:"flex-col md:basis-full flex flex-1 px-1",children:[e.jsx("label",{className:"underline font-semibold",children:"Nội dung danh hiệu và ghi chú: "}),e.jsx("input",{...ce("noidung"),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col md:basis-1/3 flex flex-1 px-1",children:[e.jsx("label",{className:"underline font-semibold",children:"Tập thể đạt danh hiệu: "}),e.jsx(z,{control:ue,name:"taptheduockhenthuong",render:({field:t})=>e.jsx(F,{options:j,className:"basic-multi-select my-4 p-1",classNamePrefix:"select",placeholder:"Tất cả",...t})})]})]}),e.jsx("div",{className:"my-2 text-center",children:e.jsxs(v,{type:"submit",color:"primary",variant:"contained",children:[e.jsx(L,{})," Tìm kiếm dữ liệu"]})})]}),e.jsxs("div",{className:"mt-6 py-4 px-2 shadow-black shadow-sm",children:[e.jsx("p",{className:"text-center text-lg mt-8 font-semibold",children:"Danh sách kết quả danh hiệu thi đua đối với tập thể đơn vị"}),e.jsx("div",{children:e.jsxs("span",{className:"font-semibold",children:["Tổng số: ",e.jsx("span",{className:"text-2xl text-red-600 font-semibold",children:s.length})," lượt đạt danh hiệu thi đua đối với tập thể"]})}),e.jsx("div",{className:"mt-8",children:e.jsx(Ve,{list:s,onClickOpenDialogDelete:de,onClickOpenDialogEdit:ne})})]}),e.jsx(qe,{open:T.status,onSubmit:me,onCloseDialogAdd:le,chidoans:h,capkhen:O,hinhthuc:k}),e.jsx(Fe,{open:q.status,item:q.item,onSubmit:ge,onCloseDialogEdit:re,chidoans:h,capkhen:O,hinhthuc:k}),e.jsx(Oe,{open:C.status,onCloseDialogDelete:oe,onConfirmDelete:xe,onCancelDelete:ie})]})};export{mt as default};
