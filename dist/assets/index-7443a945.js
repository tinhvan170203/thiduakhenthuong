import{j as e,r as u,d as F,c as oe,s as le,h as re,e as ie,u as ce,Q as j}from"./index-469ebc4a.js";import{d as de}from"./GridView-35e91095.js";import"./index.esm-a80e06b2.js";import{u as A,C as w}from"./index.esm-e24acc70.js";import{d as W}from"./Add-c692c54c.js";import{r as he,i as ue}from"./createSvgIcon-e7baeffd.js";import{q as me}from"./base-e8aaf39e.js";import{d as z}from"./Search-9d8f7eda.js";import{D as xe}from"./DialogDelete-28d67f98.js";import{d as ge}from"./donviApi-efae1bd9.js";import{S as I}from"./react-select.esm-ea0f231f.js";import{c as D}from"./chidoanApi-60758131.js";import{T as _,a as m,P as T,b as pe,c as fe,d as be,e as je,f as ve,g as E,h as M,i as V,j as H}from"./LastPage-511a91a0.js";import{d as Ce}from"./Edit-1cb268c9.js";import{d as ye,a as Ne}from"./AutoAwesomeMotion-01db5c5f.js";import{B as v}from"./Button-e3d685a6.js";import{P as ke,B as L,I as N}from"./MenuItem-22e0308b.js";import{S as Se,D as Pe,a as De,d as Te,b as we}from"./Cancel-be6c3443.js";import{S as Q}from"./Switch-a6bd2fbd.js";import{D as _e}from"./DialogActions-425572d2.js";import"./ButtonBase-ea83d2d9.js";import"./memoize-one.esm-c82963f8.js";var O={},Oe=ue;Object.defineProperty(O,"__esModule",{value:!0});var K=O.default=void 0,Be=Oe(he()),Re=e,qe=(0,Be.default)((0,Re.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");K=O.default=qe;const $e=({row:r,page:a,rowsPerPage:d,index:n,onClickOpenDialogEdit:x,onClickOpenDialogDelete:o})=>{u.useState(null);const g=F(i=>i.authReducer.roles_quanlydoanvien);return e.jsxs(_,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(m,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:a*d+n}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:r.tenchidoan}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:r.nhomdonvithuocchidoan.map(i=>e.jsxs("span",{children:[i.tendonvi," ,"]},i._id))}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:r.thutu}),e.jsx(m,{className:"border-r border-slate-300",align:"left",children:r.status===!0?e.jsx(v,{color:"success",children:"Active"}):e.jsx(v,{color:"warning",children:"NonActive"})}),e.jsxs(m,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[g&&g.includes("sửa mô hình tổ chức")&&e.jsx(v,{variant:"contained",color:"info",size:"small",onClick:()=>x(r),children:e.jsx(Ce,{style:{fontSize:"20px"}})}),g&&g.includes("xóa mô hình tổ chức")&&e.jsx(v,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>o(r._id),children:e.jsx(ye,{style:{fontSize:"20px"}})})]})]},r._id)};function G(r){const a=oe(),{count:d,page:n,rowsPerPage:x,onPageChange:o}=r,g=t=>{o(t,0)},i=t=>{o(t,n-1)},k=t=>{o(t,n+1)},h=t=>{o(t,Math.max(0,Math.ceil(d/x)-1))};return e.jsxs(L,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(N,{onClick:g,disabled:n===0,"aria-label":"first page",children:a.direction==="rtl"?e.jsx(E,{}):e.jsx(M,{})}),e.jsx(N,{onClick:i,disabled:n===0,"aria-label":"previous page",children:a.direction==="rtl"?e.jsx(V,{}):e.jsx(H,{})}),e.jsx(N,{onClick:k,disabled:n>=Math.ceil(d/x)-1,"aria-label":"next page",children:a.direction==="rtl"?e.jsx(H,{}):e.jsx(V,{})}),e.jsx(N,{onClick:h,disabled:n>=Math.ceil(d/x)-1,"aria-label":"last page",children:a.direction==="rtl"?e.jsx(M,{}):e.jsx(E,{})})]})}G.propTypes={count:T.number.isRequired,onPageChange:T.func.isRequired,page:T.number.isRequired,rowsPerPage:T.number.isRequired};function ze({list:r,onClickOpenDialogEdit:a,onClickOpenDialogDelete:d}){const[n,x]=u.useState(0),[o,g]=u.useState(10),i=n>0?Math.max(0,(1+n)*o-r.length):0,k=(t,b)=>{x(b)},h=t=>{g(parseInt(t.target.value,10)),x(0)};return e.jsxs(e.Fragment,{children:[e.jsx(pe,{component:ke,children:e.jsxs(fe,{"aria-label":"custom pagination table",children:[e.jsx(be,{children:e.jsxs(_,{children:[e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"#"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"Tên chi, liên đoàn"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(143 1 1)"},children:"Đơn vị thuộc chi, liên đoàn"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(143 1 1)"},children:"Thứ tự"}),e.jsx(m,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"200px",backgroundColor:"rgb(143 1 1)"},children:"Trạng thái"}),e.jsx(m,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(je,{children:[(o>0?r.slice(n*o,n*o+o):r).map((t,b)=>e.jsx($e,{row:t,page:n,rowsPerPage:o,index:b+1,onClickOpenDialogEdit:a,onClickOpenDialogDelete:d},t._id)),i>0&&e.jsx(_,{style:{height:53*i},children:e.jsx(m,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(ve,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:r.length,rowsPerPage:o,page:n,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:k,onRowsPerPageChange:h,ActionsComponent:G,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:b,to:C,count:l}){return`hiển thị ${b} đến ${C} bản ghi trong tổng số ${l!==-1?l:`more than ${C}`} bản ghi`}})})]})}const Ee=u.forwardRef(function(a,d){return e.jsx(Se,{direction:"up",ref:d,...a})}),Me=le(N)({position:"absolute",right:"16px",top:"4px"});function Ve({open:r,item:a,onCloseDialogEdit:d,onSubmit:n,donvis:x}){const{register:o,handleSubmit:g,control:i,resetField:k,watch:h,setValue:t,formState:{errors:b}}=A({defaultValues:{tenchidoan:"",nhomdonvithuocchidoan:"",thutu:1,status:!0}});u.useEffect(()=>{a&&(t("tenchidoan",a.tenchidoan,{shouldValidate:!0}),t("thutu",a.thutu,{shouldValidate:!0}),t("status",a.status,{shouldValidate:!0}),t("nhomdonvithuocchidoan",a.nhomdonvithuocchidoan.map(l=>({value:l._id,label:l.tendonvi})),{shouldValidate:!0}))},[a]);const C=async l=>{if(n){const f={...l,id_edit:a._id};await n(f),d()}};return e.jsx(e.Fragment,{children:e.jsxs(Pe,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(l,f)=>{f!=="backdropClick"&&d(l,f)},open:r,TransitionComponent:Ee,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(De,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"rgb(30, 41, 59 )",margin:"0px"},children:[e.jsx(Ne,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa chi đoàn, liên chi đoàn"}),e.jsx(Me,{onClick:()=>d(),children:e.jsx(Te,{style:{color:"white"}})})]}),e.jsx(we,{children:e.jsx(L,{children:e.jsxs("form",{className:"mt-2 mx-8",onSubmit:g(C),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên chi đoàn, liên chi đoàn: "]}),e.jsx("input",{...o("tenchidoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...o("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái sử dụng:"}),e.jsx(w,{name:"status",control:i,render:({field:{value:l,onChange:f}})=>e.jsx(Q,{checked:l,onChange:f})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Các đơn vị thuộc chi đoàn, liên chi đoàn: "]}),e.jsx(w,{control:i,name:"nhomdonvithuocchidoan",render:({field:l})=>e.jsx(I,{isMulti:!0,required:!0,name:"nhomdonvithuocchidoan",options:x,className:"basic-multi-select my-4",classNamePrefix:"select",placeholder:"Vui lòng chọn đơn vị",...l})})]}),e.jsx(_e,{children:e.jsxs(v,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(W,{}),e.jsx("span",{children:"Cập nhật"})]})})]})})})]})})}const ds=()=>{let[r,a]=re();const[d,n]=u.useState([]),[x,o]=u.useState(!1),[g,i]=u.useState([]),[k,h]=ie(),t=ce(),[b,C]=u.useState(""),l=u.useMemo(()=>{const s=me.parse(location.search);return{...s,tenchidoan:s.tenchidoan||""}},[location.search]),[f,B]=u.useState({status:!1,item:null}),J=()=>{B({...f,status:!1})},U=s=>{s.preventDefault(),a({...l,tenchidoan:b})},X=s=>{B({item:s,status:!0})},[y,S]=u.useState({status:!1,id_Delete:null}),Y=s=>{S({status:!0,id_Delete:s})},Z=()=>{S({...y,status:!1})},ee=()=>{S({...y,status:!1})},{register:R,handleSubmit:se,control:q,resetField:P,watch:He,formState:{errors:Fe}}=A({defaultValues:{tenchidoan:"",nhomdonvithuocchidoan:"",thutu:1,status:!0}});u.useEffect(()=>{(async()=>{try{let c=await ge.getDonvis();n(c.data.map(p=>({value:p._id,label:p.tendonvi})))}catch(c){c.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(t("/login"),j.error(c.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(c.message)}})()},[]),u.useEffect(()=>{(async()=>{try{h(!0);let c=await D.getChidoans(l);i(c.data),setTimeout(()=>{h(!1)},400)}catch(c){c.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(t("/login"),j.error(c.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(c.message)}})()},[l]);const te=async s=>{let c={...s,queryParams:l};h(!0);try{let p=await D.addChidoan(c);i(p.data.chidoans),setTimeout(()=>{h(!1)},400),P("tenchidoan"),P("thutu"),P("nhomdonvithuocchidoan"),P("status"),j.success(p.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(p){j.error(p.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),h(!1)}},ae=async s=>{let c={...s,queryParams:l};h(!0);try{let p=await D.editChidoan(c);i(p.data.chidoans),setTimeout(()=>{h(!1)},400),j.success(p.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(p){j.error(p.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),h(!1)}},ne=async()=>{h(!0);try{let s=await D.deleteChidoan(y.id_Delete,{...l});i(s.data.chidoans),setTimeout(()=>{h(!1)},400),S({...y,status:!1}),j.success(s.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(s){S({...y,status:!1}),j.error(s.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),h(!1)}},$=F(s=>s.authReducer.roles_theodoithidua);return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(de,{color:"primary",fontSize:"large"}),e.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:"Quản lý chi đoàn, liên chi đoàn"})]}),$&&$.includes("thêm mô hình tổ chức")&&e.jsxs("form",{className:"mt-2 mx-8",onSubmit:se(te),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên chi đoàn, liên chi đoàn: "]}),e.jsx("input",{...R("tenchidoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự: "]}),e.jsx("input",{...R("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:border-blue-400`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái sử dụng:"}),e.jsx(w,{name:"status",control:q,render:({field:{value:s,onChange:c}})=>e.jsx(Q,{checked:s,onChange:c})})]})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Các đơn vị thuộc chi đoàn, liên chi đoàn: "]}),e.jsx(w,{control:q,name:"nhomdonvithuocchidoan",render:({field:s})=>e.jsx(I,{isMulti:!0,required:!0,name:"nhomdonvithuocchidoan",options:d,className:"basic-multi-select my-4",classNamePrefix:"select",placeholder:"Vui lòng chọn đơn vị",...s})})]}),e.jsxs("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:[e.jsxs(v,{type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(W,{})," Thêm mới"]}),e.jsxs(v,{sx:{width:"220px",backgroundColor:"darkgray"},onClick:()=>o(!0),color:"info",variant:"contained",children:[e.jsx(z,{})," Chức năng tìm kiếm"]})]})]}),x&&e.jsxs("form",{onSubmit:s=>U(s),className:"my-2 mt-4 mx-8 bg-slate-800 p-4 rounded-lg shadow-xl","data-aos":"zoom-in-down","data-aos-once":"true",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h5",{className:"text-white text-[18px] font-semibold",children:"Tìm kiếm chi đoàn, liên chi đoàn"}),e.jsx(N,{onClick:()=>o(!1),sx:{backgroundColor:"#ccc"},children:e.jsx(K,{sx:{color:"white"}})})]}),e.jsx("div",{className:"flex space-x-4 mt-4",children:e.jsx("div",{className:"flex-col flex flex-1",children:e.jsx("input",{type:"text",defaultValue:b,className:`outline-none my-2 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:ring-white focus:border-white`,onChange:s=>C(s.target.value),placeholder:"Tên chi đoàn, liên chi đoàn"})})}),e.jsx("div",{className:"my-2 text-center",children:e.jsxs(v,{sx:{width:"200px",backgroundColor:"slategray"},type:"submit",color:"info",variant:"contained",children:[e.jsx(z,{})," Tìm kiếm"]})})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx(ze,{list:g,onClickOpenDialogDelete:Y,onClickOpenDialogEdit:X})}),e.jsx(Ve,{open:f.status,item:f.item,onCloseDialogEdit:J,onSubmit:ae,donvis:d}),e.jsx(xe,{open:y.status,onCloseDialogDelete:ee,onConfirmDelete:ne,onCancelDelete:Z})]})};export{ds as default};
