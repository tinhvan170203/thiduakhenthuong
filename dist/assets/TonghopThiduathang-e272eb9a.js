import{d as K,r as s,u as X,e as I,j as e,f as J}from"./index-469ebc4a.js";import{S as Q}from"./react-select.esm-ea0f231f.js";import{u as W}from"./index.esm-e24acc70.js";import{c as Z}from"./canboApi-a16ae5b6.js";import{t as ee}from"./thongkeApi-7ce5f50b.js";import{d as te}from"./BarChart-aae44862.js";import{S as ae}from"./SettingSendUser-11058275.js";import{R as o}from"./RectangleChart-a9fb17bf.js";import{T as se}from"./TableChitietThiduathangTonghop-84c6d80a.js";import{d as y}from"./dayjs.min-e05fe7c1.js";import{C as ne,d as le}from"./FileDownload-8fac1ea7.js";import{B as v}from"./Button-e3d685a6.js";import"./memoize-one.esm-c82963f8.js";import"./ButtonBase-ea83d2d9.js";import"./createSvgIcon-e7baeffd.js";import"./index.esm-a80e06b2.js";import"./index-bfd39377.js";import"./LastPage-511a91a0.js";import"./MenuItem-22e0308b.js";import"./Link-3fd13359.js";let oe=[{label:"STT",key:"stt"},{label:"Họ tên",key:"hoten"},{label:"Đơn vị đang công tác",key:"donvidangcongtac"},{label:"Số lượt cờ xanh",key:"blue"},{label:"Số lượt cờ vàng",key:"yellow"}];const Re=()=>{const j=K(t=>t.authReducer.vaitro_theodoithidua);s.useState([]);const[S,d]=s.useState(""),[i,u]=s.useState(""),[N,T]=s.useState(!1),[m,w]=s.useState([]),[k,C]=s.useState([]),_=X(),[ce,h]=I(),[Y,B]=s.useState(null),[D,R]=s.useState(null),[E,A]=s.useState(null),[L,M]=s.useState(null),[$,x]=s.useState([]),[V,F]=s.useState([]),[O,q]=s.useState([]),[c,g]=s.useState({label:"Tất cả",value:""}),[H,P]=s.useState([]),[r,U]=s.useState(""),{register:f,handleSubmit:re,control:de,resetField:ie,setValue:p,watch:l,formState:{errors:ue}}=W({defaultValues:{donvi:{label:"Tất cả",value:""},tungay:"",denngay:"",hoten:""}});s.useEffect(()=>{(async()=>{try{let a=await Z.fetchYearMonth(),n=await J.getUserOfKhoi({vaitro:j});C(n.data),p("tungay",a.data.year+"-01-01"),p("denngay",a.data.year+`-${("0"+a.data.month).slice(-2)}-15`),d(a.data.year+"-01-01"),u(a.data.year+`-${("0"+a.data.month).slice(-2)}-15`)}catch(a){a.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(_("/login"),toast.error(a.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(a.message)}})()},[]);const z=async t=>{let a=[...t];w(a.map(n=>n.value)),T(!1)},G=async()=>{if(m.length===0){alert("Vui lòng chọn đơn vị cần thống kê kết quả");return}h(!0);try{let t=await ee.getThiduathangs({tungay:l("tungay"),denngay:l("denngay"),donvis:m});d(l("tungay")),u(l("denngay")),B(t.data.totalCanbo),R(t.data.data_not_red.length),A(t.data.total_flag_blue),M(t.data.total_flag_yellow),x(t.data.data_not_red),F(t.data.data_not_red.map((a,n)=>({stt:n+1,hoten:a.hoten,donvidangcongtac:a.donvidangcongtac,blue:a.blue,yellow:a.yellow}))),P(t.data.data_not_red),g({label:"Tất cả",value:""}),q([{label:"Tất cả",value:""}].concat(t.data.list_doi_option)),h(!1)}catch(t){console.log(t)}};return s.useEffect(()=>{let t=[...H];if(t.length>0){const a=setTimeout(()=>{let n=t.filter(b=>b.hoten.toLowerCase().includes(r.toLowerCase())&&b.id_donvidangcongtac.includes(c.value));x(n)},500);return()=>clearTimeout(a)}},[r,c]),e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsx("div",{className:"my-2",children:e.jsx("h4",{className:"uppercase font-bold text-blue-800 text-sm md:text-[18px]",children:"Thống kê, theo dõi kết quả thi đua tháng của cán bộ, chiến sĩ theo khoảng thời gian"})}),e.jsxs("div",{className:"shadow-gray-400  shadow-md p-4 rounded-sm",children:[e.jsxs("div",{className:"my-2 mt-4 flex justify-center flex-wrap",children:[e.jsxs("div",{className:"flex-col md:basis-1/3 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Từ ngày: "}),e.jsx("input",{...f("tungay"),type:"date",className:`outline-none my-4 border rounded-md px-2 py-1 border-neutral-300\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col md:basis-1/3 flex flex-1 px-1 w-full",children:[e.jsx("label",{className:"underline font-semibold",children:"Đến ngày: "}),e.jsx("input",{...f("denngay"),type:"date",className:`outline-none my-4 border rounded-md px-2 py-1 border-neutral-300\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsx("div",{className:"flex-col px-1 flex items-end justify-center",children:e.jsxs(v,{variant:"contained",onClick:()=>G(),style:{width:"200px"},color:"primary",children:[e.jsx(te,{})," Thống kê dữ liệu"]})})]}),e.jsxs("div",{className:"flex-col md:basis-1/3 flex px-1",children:[e.jsx("label",{className:"font-semibold",children:"Đơn vị: "}),e.jsx(ae,{onSubmit:z,list:k,resetCheckbox:N})]})]}),e.jsxs("div",{className:"flex mb-8 mt-12 shadow-lg shadow-slate-300 py-8",children:[e.jsx(o,{text:"Tổng số cán bộ, chiến sĩ",number:Y,color:"bg-red-600"}),e.jsx(o,{text:"Tổng số cán bộ, chiến sĩ thi đua cờ xanh, cờ vàng",number:D,color:"bg-cyan-600"}),e.jsx(o,{text:"Tổng số lượt cờ xanh",number:E,color:"bg-blue-600"}),e.jsx(o,{text:"Tổng số lượt cờ vàng",number:L,color:"bg-yellow-600"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-center text-lg mt-8 font-semibold",children:"Danh sách cán bộ, chiến sĩ xếp loại thi đua tháng cờ xanh, cờ vàng"}),e.jsxs("h3",{className:"text-center italic",children:["(từ ngày ",y(S).format("DD/MM/YYYY")," đến ngày ",y(i).format("DD/MM/YYYY"),")"]}),e.jsxs("div",{className:"flex space-x-2 md:flex-row justify-end items-center",children:[e.jsx("div",{className:"flex-col md:basis-1/3 flex px-1",children:e.jsx("input",{value:r,placeholder:"Tìm kiếm cán bộ",name:"search",onChange:t=>U(t.target.value),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-300\r
                    focus:border-blue-500 focus:border-2`})}),e.jsx("div",{className:"flex-col md:basis-1/3 flex px-1",children:e.jsx(Q,{value:c,options:O,className:"basic-multi-select my-3 p-1",classNamePrefix:"select",placeholder:"Đơn vị công tác tính đến ngày xếp loại cờ xanh, vàng",onChange:t=>g(t)})})]}),e.jsx("div",{className:"mt-4 text-end mb-2 md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:e.jsx(v,{variant:"contained",color:"success",size:"small",children:e.jsxs(ne,{data:V,headers:oe,filename:`danhsachcoxanhcovang_${l("tungay")}_${l("denngay")}`,children:[e.jsx(le,{}),e.jsx("span",{className:"text-sm ml-1 text-white",children:"Xuất file excel"})]})})}),e.jsx(se,{list:$,denngay:i})]})]})};export{Re as default};
