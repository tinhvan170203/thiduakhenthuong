import{r as x,d as A,j as e,c as Y,s as Z,u as ee,e as se,Q as j,f as S}from"./index-469ebc4a.js";import{d as ae}from"./GridView-35e91095.js";import"./index.esm-a80e06b2.js";import{u as E,C}from"./index.esm-e24acc70.js";import{d as H}from"./Add-c692c54c.js";import{S as N}from"./react-select.esm-ea0f231f.js";import{r as te}from"./roleApi-3fcd7e7f.js";import{T as w,a as h,P as q,b as le,c as ne,d as re,e as oe,f as ie,g as V,h as M,i as $,j as z}from"./LastPage-511a91a0.js";import{d as de}from"./Edit-1cb268c9.js";import{d as ce,a as ue}from"./AutoAwesomeMotion-01db5c5f.js";import{B as T}from"./Button-e3d685a6.js";import{P as he,B as F,I as D}from"./MenuItem-22e0308b.js";import{D as me}from"./DialogDelete-28d67f98.js";import{S as ge,D as pe,a as xe,d as fe,b as be}from"./Cancel-be6c3443.js";import{D as je}from"./DialogActions-425572d2.js";import{d as ke}from"./donviApi-efae1bd9.js";import{c as ve}from"./chidoanApi-60758131.js";import"./createSvgIcon-e7baeffd.js";import"./ButtonBase-ea83d2d9.js";import"./memoize-one.esm-c82963f8.js";const ye=({row:n,page:t,rowsPerPage:d,index:r,onClickOpenDialogEdit:m,onClickOpenDialogDelete:i})=>{x.useState(null);const g=A(o=>o.authReducer.roles_quanlydoanvien);return e.jsxs(w,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(h,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:t*d+r}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:n.tentaikhoan}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:n.matkhau}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:n.roles.map(o=>e.jsxs("span",{children:[o.tennhom,", "]},o._id))}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:n.quantrinhomdonvi.map(o=>e.jsxs("span",{children:[o.tendonvi,", "]},o._id))}),e.jsx(h,{className:"border-r border-slate-300",align:"left",children:n.quantrinhomchidoan.map(o=>e.jsxs("span",{children:[o.tenchidoan,", "]},o._id))}),e.jsxs(h,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[g&&g.includes("sửa tài khoản")&&e.jsx(T,{variant:"contained",color:"info",size:"small",onClick:()=>m(n),children:e.jsx(de,{style:{fontSize:"20px"}})}),g&&g.includes("xóa tài khoản")&&e.jsx(T,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>i(n._id),children:e.jsx(ce,{style:{fontSize:"20px"}})})]})]},n._id)};function W(n){const t=Y(),{count:d,page:r,rowsPerPage:m,onPageChange:i}=n,g=s=>{i(s,0)},o=s=>{i(s,r-1)},f=s=>{i(s,r+1)},k=s=>{i(s,Math.max(0,Math.ceil(d/m)-1))};return e.jsxs(F,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(D,{onClick:g,disabled:r===0,"aria-label":"first page",children:t.direction==="rtl"?e.jsx(V,{}):e.jsx(M,{})}),e.jsx(D,{onClick:o,disabled:r===0,"aria-label":"previous page",children:t.direction==="rtl"?e.jsx($,{}):e.jsx(z,{})}),e.jsx(D,{onClick:f,disabled:r>=Math.ceil(d/m)-1,"aria-label":"next page",children:t.direction==="rtl"?e.jsx(z,{}):e.jsx($,{})}),e.jsx(D,{onClick:k,disabled:r>=Math.ceil(d/m)-1,"aria-label":"last page",children:t.direction==="rtl"?e.jsx(M,{}):e.jsx(V,{})})]})}W.propTypes={count:q.number.isRequired,onPageChange:q.func.isRequired,page:q.number.isRequired,rowsPerPage:q.number.isRequired};function Ce({list:n,onClickOpenDialogEdit:t,onClickOpenDialogDelete:d}){const[r,m]=x.useState(0),[i,g]=x.useState(10),o=r>0?Math.max(0,(1+r)*i-n.length):0,f=(s,c)=>{m(c)},k=s=>{g(parseInt(s.target.value,10)),m(0)};return e.jsxs(e.Fragment,{children:[e.jsx(le,{component:he,children:e.jsxs(ne,{"aria-label":"custom pagination table",children:[e.jsx(re,{children:e.jsxs(w,{children:[e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"#"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"Tên tài khoản"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )"},children:"mật khẩu"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Nhóm quyền hệ thống"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Quản trị nhóm đơn vị"}),e.jsx(h,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(30, 41, 59 )"},children:"Quản trị nhóm chi đoàn"}),e.jsx(h,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(30, 41, 59 )",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(oe,{children:[(i>0?n.slice(r*i,r*i+i):n).map((s,c)=>e.jsx(ye,{row:s,page:r,rowsPerPage:i,index:c+1,onClickOpenDialogEdit:t,onClickOpenDialogDelete:d},s._id)),o>0&&e.jsx(w,{style:{height:53*o},children:e.jsx(h,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(ie,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:n.length,rowsPerPage:i,page:r,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:f,onRowsPerPageChange:k,ActionsComponent:W,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:c,to:y,count:P}){return`hiển thị ${c} đến ${y} bản ghi trong tổng số ${P!==-1?P:`more than ${y}`} bản ghi`}})})]})}const Ne=x.forwardRef(function(t,d){return e.jsx(ge,{direction:"up",ref:d,...t})}),Pe=Z(D)({position:"absolute",right:"16px",top:"4px"});function De({open:n,item:t,onCloseDialogEdit:d,onSubmit:r,roles:m,donvis:i,chidoans:g}){const{register:o,handleSubmit:f,control:k,resetField:s,setValue:c,watch:y,formState:{errors:P}}=E({defaultValues:{tentaikhoan:"",matkhau:"",roles:"",quantrinhomchidoan:"",quantrinhomdonvi:""}});x.useEffect(()=>{t&&(c("tentaikhoan",t.tentaikhoan,{shouldValidate:!0}),c("matkhau",t.matkhau,{shouldValidate:!0}),c("roles",t.roles.map(a=>({value:a._id,label:a.tennhom})),{shouldValidate:!0}),c("quantrinhomdonvi",t.quantrinhomdonvi.map(a=>({value:a._id,label:a.tendonvi})),{shouldValidate:!0}),c("quantrinhomchidoan",t.quantrinhomchidoan.map(a=>({value:a._id,label:a.tenchidoan})),{shouldValidate:!0}))},[t]);const _=async a=>{if(r){const b={...a,id_edit:t._id};await r(b),d()}};return e.jsx(e.Fragment,{children:e.jsxs(pe,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(a,b)=>{b!=="backdropClick"&&d(a,b)},open:n,TransitionComponent:Ne,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(xe,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"rgb(30, 41, 59 )",margin:"0px"},children:[e.jsx(ue,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa tài khoản người dùng"}),e.jsx(Pe,{onClick:()=>d(),children:e.jsx(fe,{style:{color:"white"}})})]}),e.jsx(be,{children:e.jsx(F,{children:e.jsxs("form",{className:"mt-2 mx-8",onSubmit:f(_),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên tài khoản: "]}),e.jsx("input",{...o("tentaikhoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Mật khẩu: "]}),e.jsx("input",{...o("matkhau",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nhóm quyền: "]}),e.jsx(C,{control:k,name:"roles",render:({field:a})=>e.jsx(N,{isMulti:!0,options:m,className:"basic-multi-select my-4",classNamePrefix:"select",...a,required:!0})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Quản trị nhóm đơn vị: "]}),e.jsx(C,{control:k,name:"quantrinhomdonvi",render:({field:a})=>e.jsx(N,{isMulti:!0,options:i,className:"basic-multi-select my-4",classNamePrefix:"select",...a,required:!0})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Quản trị nhóm chi đoàn: "]}),e.jsx(C,{control:k,name:"quantrinhomchidoan",render:({field:a})=>e.jsx(N,{required:!0,isMulti:!0,options:g,className:"basic-multi-select my-4",classNamePrefix:"select",...a})})]}),e.jsx(je,{children:e.jsxs(T,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(H,{}),e.jsx("span",{children:"Cập nhật"})]})})]})})})]})})}const Ge=()=>{const[n,t]=x.useState([]),[d,r]=x.useState([]),[m,i]=x.useState([]),[g,o]=x.useState([]),f=ee(),[k,s]=se();A(l=>l.authReducer.roles_theodoithidua);const[c,y]=x.useState({status:!1,item:null}),P=()=>{y({...c,status:!1})},_=l=>{y({item:l,status:!0})},[a,b]=x.useState({status:!1,id_Delete:null}),Q=l=>{b({status:!0,id_Delete:l})},L=()=>{b({...a,status:!1})},U=()=>{b({...a,status:!1})},{register:R,handleSubmit:I,control:O,resetField:B,watch:Se,formState:{errors:qe}}=E({defaultValues:{tentaikhoan:"",matkhau:"",roles:"",quantrinhomdonvi:"",quantrinhomchidoan:""}});x.useEffect(()=>{(async()=>{try{let u=await te.getRoles(),p=await ke.getDonvis(),X=await ve.getChidoans({tenchidoan:""});r(u.data.map(v=>({value:v._id,label:v.tennhom}))),i(p.data.map(v=>({label:v.tendonvi,value:v._id}))),o(X.data.map(v=>({label:v.tenchidoan,value:v._id})))}catch(u){u.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(f("/login"),j.error(u.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(u.message)}})()},[]),x.useEffect(()=>{(async()=>{s(!0);try{let u=await S.getUsers();t(u.data),setTimeout(()=>{s(!1)},400)}catch(u){u.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(f("/login"),s(!1),j.error(u.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),s(!1),console.log(u.message)}})()},[]);const K=async l=>{let u={...l};s(!0);try{let p=await S.addUser(u);t(p.data.users),setTimeout(()=>{s(!1)},400),B("tentaikhoan"),B("matkhau"),B("roles"),j.success(p.data.message,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(p){j.error(p.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},G=async l=>{let u={...l};s(!0);try{let p=await S.editUser(u);t(p.data.users),setTimeout(()=>{s(!1)},400),j.success(p.data.message,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(p){p.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(f("/login"),s(!1),j.error(p.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),j.error(p.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}},J=async()=>{s(!0);try{let l=await S.deleteUser(a.id_Delete);t(l.data.users),setTimeout(()=>{s(!1)},400),b({...a,status:!1}),j.success(l.data.message,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(l){b({...a,status:!1}),l.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(f("/login"),s(!1),j.error(l.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),j.error(l.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),s(!1)}};return e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ae,{color:"primary",fontSize:"large"}),e.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:"Quản lý tài khoản hệ thống"})]}),e.jsxs("form",{className:"mt-2 mx-8",onSubmit:I(K),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Tên tài khoản: "]}),e.jsx("input",{...R("tentaikhoan",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`,placeholder:"Vui lòng nhập tên tài khoản"})]}),e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Mật khẩu: "]}),e.jsx("input",{...R("matkhau",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`,placeholder:"Vui lòng nhập mật khẩu"})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nhóm quyền: "]}),e.jsx(C,{control:O,name:"roles",render:({field:l})=>e.jsx(N,{required:!0,isMulti:!0,options:d,className:"basic-multi-select my-4",classNamePrefix:"select",...l,placeholder:"Vui lòng chọn nhóm quyền hệ thống"})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Phân quyền quản lý các đơn vị: "]}),e.jsx(C,{control:O,name:"quantrinhomdonvi",render:({field:l})=>e.jsx(N,{required:!0,isMulti:!0,options:m,className:"basic-multi-select my-4",classNamePrefix:"select",...l,placeholder:"Vui lòng chọn đơn vị"})})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Phân quyền quản lý các chi đoàn: "]}),e.jsx(C,{control:O,name:"quantrinhomchidoan",render:({field:l})=>e.jsx(N,{required:!0,placeholder:"Vui lòng chọn chi đoàn",isMulti:!0,options:g,className:"basic-multi-select my-4",classNamePrefix:"select",...l})})]}),e.jsx("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:e.jsxs(T,{type:"submit",sx:{width:"220px",backgroundColor:"gray"},color:"primary",variant:"contained",children:[e.jsx(H,{})," Thêm mới"]})})]}),e.jsx("div",{className:"mt-6 mx-8",children:e.jsx(Ce,{list:n,onClickOpenDialogDelete:Q,onClickOpenDialogEdit:_})}),e.jsx(De,{open:c.status,item:c.item,onCloseDialogEdit:P,onSubmit:G,roles:d,donvis:m,chidoans:g}),e.jsx(me,{open:a.status,onCloseDialogDelete:U,onConfirmDelete:J,onCancelDelete:L})]})};export{Ge as default};
