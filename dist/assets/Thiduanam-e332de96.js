import{r as x,j as e,c as z,e as A,u as K,d as _,Q as T,N as E}from"./index-469ebc4a.js";import{d as V}from"./Search-9d8f7eda.js";import"./index.esm-a80e06b2.js";import{S as F}from"./react-select.esm-ea0f231f.js";import{c as k}from"./canboApi-a16ae5b6.js";import{T as H,a as d,P as S,b as Q,c as G,d as X,e as J,f as U,g as B,h as R,i as w,j as W}from"./LastPage-511a91a0.js";import"./dayjs.min-e05fe7c1.js";import{P as Z,B as ee,I as N}from"./MenuItem-22e0308b.js";import{B as I}from"./Button-e3d685a6.js";import"./createSvgIcon-e7baeffd.js";import"./ButtonBase-ea83d2d9.js";import"./memoize-one.esm-c82963f8.js";const ae=({row:t,page:h,rowsPerPage:f,index:c,onHandleChangeItem:s,onHandleChangeText:p})=>{const[u,b]=x.useState("null"),[y,m]=x.useState("");x.useEffect(()=>{t&&(b(t.thiduanam.result),m(t.thiduanam.ghichu))},[t]);const n=i=>{b(i.target.value),s(t,i.target.value)},g=i=>{m(i.target.value),p(t,i.target.value)};return e.jsxs(H,{children:[e.jsx(d,{className:"border-r border-slate-300",align:"center",style:{fontWeight:"bold",padding:"2px 2px"},children:h*f+c}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"},children:t.hoten}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{padding:"2px 2px"},children:t.bachamPopulate[0].bacham}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{padding:"2px 2px"},children:e.jsx("p",{className:"truncate",children:t.donviPopulate[0].tendoi})}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"},children:e.jsxs("select",{className:"outline-none p-2 w-full",onChange:i=>n(i),value:u,children:[e.jsx("option",{value:"null",children:"Chưa phân loại"}),e.jsx("option",{value:"Không hoàn thành nhiệm vụ",children:"Không hoàn thành nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành nhiệm vụ",children:"Hoàn thành nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành tốt nhiệm vụ",children:"Hoàn thành tốt nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành xuất sắc nhiệm vụ",children:"Hoàn thành xuất sắc nhiệm vụ"})]})}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{padding:"2px 2px"},children:e.jsx("input",{type:"text",className:`w-full outline-none border rounded-md px-2 py-[6px] border-neutral-300\r
                   focus:border-blue-500 focus:border-2`,value:y,onChange:i=>g(i)})})]},t._id)};function O(t){const h=z(),{count:f,page:c,rowsPerPage:s,onPageChange:p}=t,u=n=>{p(n,0)},b=n=>{p(n,c-1)},y=n=>{p(n,c+1)},m=n=>{p(n,Math.max(0,Math.ceil(f/s)-1))};return e.jsxs(ee,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(N,{onClick:u,disabled:c===0,"aria-label":"first page",children:h.direction==="rtl"?e.jsx(B,{}):e.jsx(R,{})}),e.jsx(N,{onClick:b,disabled:c===0,"aria-label":"previous page",children:h.direction==="rtl"?e.jsx(w,{}):e.jsx(W,{})}),e.jsx(N,{onClick:y,disabled:c>=Math.ceil(f/s)-1,"aria-label":"next page",children:h.direction==="rtl"?e.jsx(W,{}):e.jsx(w,{})}),e.jsx(N,{onClick:m,disabled:c>=Math.ceil(f/s)-1,"aria-label":"last page",children:h.direction==="rtl"?e.jsx(R,{}):e.jsx(B,{})})]})}O.propTypes={count:S.number.isRequired,onPageChange:S.func.isRequired,page:S.number.isRequired,rowsPerPage:S.number.isRequired};function te({list:t,onHandleChangeAll:h,onHandleChangeItem:f,onHandleChangeText:c}){const[s,p]=x.useState(0),[u,b]=x.useState(10);s>0&&Math.max(0,(1+s)*u-t.length);const y=(n,g)=>{p(g)},m=n=>{b(parseInt(n.target.value,10)),p(0)};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{component:Z,style:{overflowX:"scroll"},children:e.jsxs(G,{"aria-label":"custom pagination table",children:[e.jsxs(X,{children:[e.jsxs(H,{children:[e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"#"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"250px"},children:"Họ tên"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"120px"},children:"Bậc hàm"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"300px"},children:"Đội, tổ công tác"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"120px"},children:"Kết quả xếp loại thi đua năm"}),e.jsx(d,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",minWidth:"300px"},children:"Ghi chú"})]}),e.jsxs(H,{children:[e.jsx(d,{colSpan:4,className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"}}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"},children:e.jsxs("select",{onChange:n=>h(n.target.value),className:"outline-none px-2 w-full",defaultValue:"null",children:[e.jsx("option",{value:"null",children:"Chưa phân loại"}),e.jsx("option",{value:"Không hoàn thành nhiệm vụ",children:"Không hoàn thành nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành nhiệm vụ",children:"Hoàn thành nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành tốt nhiệm vụ",children:"Hoàn thành tốt nhiệm vụ"}),e.jsx("option",{value:"Hoàn thành xuất sắc nhiệm vụ",children:"Hoàn thành xuất sắc nhiệm vụ"})]})}),e.jsx(d,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold",padding:"2px 2px"}})]})]}),e.jsx(J,{children:(u>0?t.slice(s*u,s*u+u):t).map((n,g)=>e.jsx(ae,{row:n,page:s,rowsPerPage:u,index:g+1,onHandleChangeItem:f,onHandleChangeText:c},n._id))})]})}),e.jsx("div",{children:e.jsx(U,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:t.length,rowsPerPage:u,page:s,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:y,onRowsPerPageChange:m,ActionsComponent:O,labelRowsPerPage:"Số cán bộ hiển thị trên mỗi trang",labelDisplayedRows:function({from:g,to:i,count:P}){return`hiển thị ${g} đến ${i} cán bộ trong tổng số ${P!==-1?P:`more than ${i}`} cán bộ`}})})]})}const me=()=>{const[t,h]=x.useState([]),[f,c]=x.useState(1),[s,p]=x.useState(2022),[u,b]=x.useState([]),[y,m]=A(),[n,g]=x.useState([]),[i,P]=x.useState(""),$=K();if(_(a=>a.authReducer.vaitro_theodoithidua)!=="Quản trị thông thường")return T.error("Tài khoản không có truy cập trang này",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!1,draggable:!1,progress:void 0,theme:"light"}),e.jsx(E,{to:"/login",replace:!0});x.useEffect(()=>{(async()=>{try{let l=await k.fetchYearMonth();p(l.data.year),c(l.data.year);let r=[];for(let o=l.data.year;o>=2020;o--)r.push({label:o,value:o});b(r)}catch(l){l.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&($("/login"),T.error(l.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})),console.log(l.message)}})()},[]);const D=async()=>{try{m(!0);let a=await k.fetchThiduanam({year:s});g(a.data),h(a.data),c(s),m(!1)}catch(a){console.log(a.message)}};x.useEffect(()=>{const a=setTimeout(()=>{let r=[...t].filter(o=>o.hoten.toLowerCase().includes(i.toLowerCase()));g(r)},500);return()=>clearTimeout(a)},[i]);const q=a=>{let l=[...n];l=l.map(o=>({...o,thiduanam:{ghichu:o.thiduanam.ghichu,result:a}})),g(l);let r=[...t];for(let o of l){let j=r.findIndex(C=>C._id.toString()===o._id.toString());r[j].thiduanam.result=o.thiduanam.result}h(r)},L=(a,l)=>{let r=[...n],o=r.findIndex(v=>v._id.toString()===a._id.toString());r[o].thiduanam.result=l;let j=[...t],C=r.findIndex(v=>v._id.toString()===a._id.toString());j[C].thiduanam.result=l,h(j),g(r)},M=(a,l)=>{let r=[...n],o=r.findIndex(v=>v._id.toString()===a._id.toString());r[o].thiduanam.ghichu=l,g(r);let j=[...t],C=j.findIndex(v=>v._id.toString()===a._id.toString());j[C].thiduanam.ghichu=l,h(j)},Y=async()=>{let a={doanviens:t,year:f};try{m(!0);let l=await k.updateThiduanam(a);T.success(l.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),m(!1)}catch(l){console.log(l.message)}};return _(a=>a.authReducer.roles_theodoithidua),e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsx("div",{className:"my-2",children:e.jsx("h4",{className:"uppercase font-bold text-blue-800 text-sm md:text-[18px]",children:"Quản lý xếp loại thi đua năm của cán bộ, chiến sĩ"})}),e.jsxs("div",{className:"flex space-x-2 md:flex-row justify-end items-center",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/6",children:[e.jsx("label",{className:"underline font-semibold",children:"Năm:"}),e.jsx(F,{value:{label:s,value:s},required:!0,name:"nam",options:u,className:"basic-multi-select my-4",classNamePrefix:"select",onChange:a=>p(a.value)})]}),e.jsx("div",{className:"flex-col flex md:basis-1/6",children:e.jsxs(I,{onClick:()=>D(),color:"primary",variant:"contained",children:[e.jsx(V,{})," Lấy dữ liệu thi đua"]})})]}),e.jsxs("div",{className:"mx-8 flex space-x-2 items-center",children:[e.jsx("input",{type:"text",defaultValue:i,onChange:a=>P(a.target.value),placeholder:"Tìm kiếm họ tên",className:`outline-none my-4 border rounded-md px-2 py-[6px] border-neutral-300\r
                   focus:border-blue-500 focus:border-2`}),e.jsx(I,{onClick:()=>Y(),color:"success",variant:"contained",children:" Lưu dữ liệu thi đua năm"})]}),e.jsxs("div",{className:"mt-2 shadow-md shadow-gray-500 rounded-md",children:[e.jsxs("p",{className:"text-center text-lg my-8 font-semibold",children:["Kết quả xếp loại thi đua năm ",f," của đơn vị"]}),e.jsx(te,{list:n,onHandleChangeItem:L,onHandleChangeAll:q,onHandleChangeText:M})]})]})};export{me as default};
