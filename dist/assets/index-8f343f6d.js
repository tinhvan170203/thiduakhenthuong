import{r as h,d as T,j as e,c as ee,s as te,u as se,Q as j,N as ae,h as oe,e as re}from"./index-371a4e8f.js";import"./index.esm-a80e06b2.js";import{u as E,C as H}from"./index.esm-dbde89ce.js";import{d as _}from"./Search-d057eaaa.js";import{d as F}from"./Add-b80d7046.js";import{q as ne}from"./base-e8aaf39e.js";import{n as P}from"./notificationApi-29beb182.js";import{T as w,a as x,P as S,b as le,c as ie,d as de,e as ce,f as ue,g as R,h as $,i as q,j as z}from"./LastPage-410e0def.js";import{d as he}from"./Edit-3f190fda.js";import{d as me,a as ge}from"./AutoAwesomeMotion-e68ec9ef.js";import{B as y}from"./Button-c29e04f7.js";import{P as xe,B as M,I as k}from"./MenuItem-0a823130.js";import{S as fe,D as pe,a as be,d as je,b as ye}from"./Cancel-e1a5b8c1.js";import{S as V}from"./Switch-4739740e.js";import{D as Ce}from"./DialogActions-8285de49.js";import{D as Ne}from"./DialogDelete-f47675d7.js";import"./createSvgIcon-b5eb2c40.js";import"./ButtonBase-3ca56fd5.js";const ve=({row:n,page:r,rowsPerPage:i,index:s,onClickOpenDialogEdit:c,onClickOpenDialogDelete:l})=>(h.useState(null),T(p=>p.authReducer.roles_quanlydoanvien),e.jsxs(w,{className:"hover:bg-slate-200 transition duration-300",children:[e.jsx(x,{className:"border-r border-slate-300",align:"left",style:{fontWeight:"bold"},children:r*i+s}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:n.thongbao}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:n.thutu}),e.jsx(x,{className:"border-r border-slate-300",align:"left",children:n.status===!0?e.jsx(y,{color:"success",children:"Đang hiển thị"}):e.jsx(y,{color:"warning",children:"Không hiển thị"})}),e.jsxs(x,{align:"right",className:"bg-gray-300 flex justify-center items-center space-x-1 hover:bg-slate-500 transition duration-300",style:{width:"180px"},children:[e.jsx(y,{variant:"contained",color:"info",size:"small",onClick:()=>c(n),children:e.jsx(he,{style:{fontSize:"20px"}})}),e.jsx(y,{variant:"contained",color:"error",size:"small",style:{marginLeft:"4px"},onClick:()=>l(n._id),children:e.jsx(me,{style:{fontSize:"20px"}})})]})]},n._id));function W(n){const r=ee(),{count:i,page:s,rowsPerPage:c,onPageChange:l}=n,p=a=>{l(a,0)},f=a=>{l(a,s-1)},b=a=>{l(a,s+1)},C=a=>{l(a,Math.max(0,Math.ceil(i/c)-1))};return e.jsxs(M,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(k,{onClick:p,disabled:s===0,"aria-label":"first page",children:r.direction==="rtl"?e.jsx(R,{}):e.jsx($,{})}),e.jsx(k,{onClick:f,disabled:s===0,"aria-label":"previous page",children:r.direction==="rtl"?e.jsx(q,{}):e.jsx(z,{})}),e.jsx(k,{onClick:b,disabled:s>=Math.ceil(i/c)-1,"aria-label":"next page",children:r.direction==="rtl"?e.jsx(z,{}):e.jsx(q,{})}),e.jsx(k,{onClick:C,disabled:s>=Math.ceil(i/c)-1,"aria-label":"last page",children:r.direction==="rtl"?e.jsx($,{}):e.jsx(R,{})})]})}W.propTypes={count:S.number.isRequired,onPageChange:S.func.isRequired,page:S.number.isRequired,rowsPerPage:S.number.isRequired};function ke({list:n,onClickOpenDialogEdit:r,onClickOpenDialogDelete:i}){const[s,c]=h.useState(0),[l,p]=h.useState(10),f=s>0?Math.max(0,(1+s)*l-n.length):0,b=(a,o)=>{c(o)},C=a=>{p(parseInt(a.target.value,10)),c(0)};return e.jsxs(e.Fragment,{children:[e.jsx(le,{component:xe,children:e.jsxs(ie,{"aria-label":"custom pagination table",children:[e.jsx(de,{children:e.jsxs(w,{children:[e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"#"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)"},children:"Thông báo"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"100px",backgroundColor:"rgb(143 1 1)"},children:"Thứ tự"}),e.jsx(x,{align:"left",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",minWidth:"200px",backgroundColor:"rgb(143 1 1)"},children:"Trạng thái hiển thị"}),e.jsx(x,{align:"center",style:{fontSize:"14px",color:"#fff",padding:"8px 8px",backgroundColor:"rgb(143 1 1)",maxWidth:"150px"},children:"Thao tác"})]})}),e.jsxs(ce,{children:[(l>0?n.slice(s*l,s*l+l):n).map((a,o)=>e.jsx(ve,{row:a,page:s,rowsPerPage:l,index:o+1,onClickOpenDialogEdit:r,onClickOpenDialogDelete:i},a._id)),f>0&&e.jsx(w,{style:{height:53*f},children:e.jsx(x,{colSpan:6})})]})]})}),e.jsx("div",{children:e.jsx(ue,{rowsPerPageOptions:[10,25,50,100,{label:"Tất cả",value:-1}],count:n.length,rowsPerPage:l,page:s,SelectProps:{inputProps:{"aria-label":"rows per page"},native:!0},component:"div",onPageChange:b,onRowsPerPageChange:C,ActionsComponent:W,labelRowsPerPage:"Số bản ghi hiển thị trên mỗi trang",labelDisplayedRows:function({from:o,to:d,count:u}){return`hiển thị ${o} đến ${d} bản ghi trong tổng số ${u!==-1?u:`more than ${d}`} bản ghi`}})})]})}const Pe=h.forwardRef(function(r,i){return e.jsx(fe,{direction:"up",ref:i,...r})}),Se=te(k)({position:"absolute",right:"16px",top:"4px"});function De({open:n,item:r,onCloseDialogEdit:i,onSubmit:s}){const{register:c,handleSubmit:l,control:p,resetField:f,setValue:b,watch:C,formState:{errors:a}}=E({defaultValues:{thongbao:"",thutu:1,status:!0}});h.useEffect(()=>{r&&(b("thongbao",r.thongbao,{shouldValidate:!0}),b("thutu",r.thutu,{shouldValidate:!0}),b("status",r.status,{shouldValidate:!0}))},[r]);const o=async d=>{if(s){const u={...d,id_edit:r._id};await s(u),i()}};return e.jsx(e.Fragment,{children:e.jsxs(pe,{maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!0,onClose:(d,u)=>{u!=="backdropClick"&&i(d,u)},open:n,TransitionComponent:Pe,keepMounted:!0,"aria-describedby":"alert-dialog-slide-description",children:[e.jsxs(be,{style:{display:"flex",borderBottom:"1px solid #ccc",backgroundColor:"#03528f",margin:"0px"},children:[e.jsx(ge,{style:{color:"white",fontSize:"24px",marginRight:"8px"}}),e.jsx("span",{className:"text-white text-[18px]",children:"Chỉnh sửa thông báo"}),e.jsx(Se,{onClick:()=>i(),children:e.jsx(je,{style:{color:"white"}})})]}),e.jsx(ye,{children:e.jsx(M,{children:e.jsxs("form",{className:"mt-2 mx-8",onSubmit:l(o),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nội dung thông báo: "]}),e.jsx("input",{...c("thongbao",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự xuất hiện: "]}),e.jsx("input",{...c("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái hiển thị:"}),e.jsx(H,{name:"status",control:p,render:({field:{value:d,onChange:u}})=>e.jsx(V,{checked:d,onChange:u})})]})]}),e.jsx(Ce,{children:e.jsxs(y,{color:"primary",variant:"contained",type:"submit",style:{margin:"4px auto"},children:[e.jsx(F,{}),e.jsx("span",{children:"Cập nhật"})]})})]})})})]})})}const Ge=()=>{let n=T(t=>t.authReducer.vaitro_theodoithidua);const r=se();if(n!=="Quản trị hệ thống")return j.error("Tài khoản không có truy cập trang này",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!1,draggable:!1,progress:void 0,theme:"light"}),e.jsx(ae,{to:"/login",replace:!0});const[i,s]=h.useState(!1),[c,l]=h.useState(""),[p,f]=h.useState([]);let[b,C]=oe();const[a,o]=re(),d=h.useMemo(()=>{const t=ne.parse(location.search);return{...t,thongbao:t.thongbao||""}},[location.search]),[u,O]=h.useState({status:!1,item:null}),A=()=>{O({...u,status:!1})},L=t=>{O({item:t,status:!0})},[N,v]=h.useState({status:!1,id_Delete:null}),I=t=>{v({status:!0,id_Delete:t})},Q=()=>{v({...N,status:!1})},K=()=>{v({...N,status:!1})},{register:B,handleSubmit:G,control:J,resetField:D,watch:Te,formState:{errors:we}}=E({defaultValues:{thongbao:"",thutu:1,status:!0}}),U=t=>{t.preventDefault(),C({...d,thongbao:c})};h.useEffect(()=>{(async()=>{try{o(!0);let m=await P.getNotifications(d);f(m.data),a(m.data),setTimeout(()=>{o(!1)},400)}catch(m){m.message==="Token không hợp lệ hoặc đã hết hạn. Vui lòng đăng nhập lại"&&(r("/login"),o(!1),j.error(m.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}))}})()},[d]);const X=async t=>{let m={...t,queryParams:d};o(!0);try{let g=await P.addNotification(m);f(g.data.notifications),a(g.data.notifications),setTimeout(()=>{o(!1)},400),D("thongbao"),D("thutu"),D("status"),j.success(g.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(g){j.error(g.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),o(!1)}},Y=async t=>{let m={...t,queryParams:d};o(!0);try{let g=await P.editNotification(m);f(g.data.notifications),a(g.data.notifications),setTimeout(()=>{o(!1)},400),j.success(g.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(g){j.error(g.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),o(!1)}},Z=async()=>{o(!0);try{let t=await P.deleteNotification(N.id_Delete,{...d});f(t.data.notifications),a(t.data.notifications),setTimeout(()=>{o(!1)},400),v({...N,status:!1}),j.success(t.data.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}catch(t){v({...N,status:!1}),j.error(t.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),o(!1)}};return T(t=>t.authReducer.roles_theodoithidua),e.jsxs("div",{className:"pr-2","data-aos":"fade-left","data-aos-once":"true",children:[e.jsx("div",{className:"my-2",children:e.jsx("h4",{className:"uppercase font-bold text-blue-800 text-sm md:text-[18px]",children:"Quản lý thông báo hệ thống"})}),e.jsxs("form",{className:"mt-2 px-6 py-4 shadow-gray-400 shadow-md",onSubmit:G(X),children:[e.jsxs("div",{className:"flex-col flex",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Nội dung thông báo mới: "]}),e.jsx("input",{...B("thongbao",{required:!0}),type:"text",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsxs("label",{className:"underline font-semibold",children:[e.jsx("span",{className:"text-red-600 font-semibold",children:" (*)"})," Thứ tự xuất hiện: "]}),e.jsx("input",{...B("thutu",{required:!0}),type:"number",className:`outline-none my-4 border rounded-md p-2 border-neutral-600\r
                  focus:border-blue-500 focus:border-2`})]}),e.jsxs("div",{className:"flex-col flex md:basis-1/2",children:[e.jsx("label",{className:"underline font-semibold",children:"Trạng thái hiển thị:"}),e.jsx(H,{name:"status",control:J,render:({field:{value:t,onChange:m}})=>e.jsx(V,{checked:t,onChange:m})})]})]}),e.jsxs("div",{className:"md:space-x-2 space-y-2 md:space-y-0 md:block flex flex-col items-center",children:[e.jsxs(y,{type:"submit",color:"primary",variant:"contained",children:[e.jsx(F,{})," Thêm mới"]}),e.jsxs(y,{onClick:()=>s(!0),color:"info",variant:"contained",children:[e.jsx(_,{})," Chức năng tìm kiếm"]})]})]}),i&&e.jsxs("form",{onSubmit:t=>U(t),className:"my-2 mt-4 shadow-gray-400 shadow-md p-4 rounded-lg","data-aos":"zoom-in-down","data-aos-once":"true",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx("h5",{className:"text-white text-[18px] font-semibold",children:"Tìm kiếm thông báo"})}),e.jsx("div",{className:"flex space-x-4 mt-2",children:e.jsx("div",{className:"flex-col flex flex-1",children:e.jsx("input",{type:"text",defaultValue:c,className:`outline-none my-2 border rounded-md p-2 border-neutral-600\r
                  focus:ring-2 focus:ring-white focus:border-white`,onChange:t=>l(t.target.value),placeholder:"Nội dung thông báo"})})}),e.jsx("div",{className:"my-2 text-center",children:e.jsxs(y,{type:"submit",color:"info",variant:"contained",children:[e.jsx(_,{})," Tìm kiếm"]})})]}),e.jsx("div",{className:"mt-6 px-2 shadow-black shadow-sm",children:e.jsx(ke,{list:p,onClickOpenDialogDelete:I,onClickOpenDialogEdit:L})}),e.jsx(De,{open:u.status,item:u.item,onCloseDialogEdit:A,onSubmit:Y}),e.jsx(Ne,{open:N.status,onCloseDialogDelete:K,onConfirmDelete:Z,onCancelDelete:Q})]})};export{Ge as default};
